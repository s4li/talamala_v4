<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>اصالت‌سنجی شمش - طلاملا</title>
    <link rel="stylesheet" href="/static/vendor/bootstrap/css/bootstrap.rtl.min.css?v={{ STATIC_VER }}">
    <link rel="stylesheet" href="/static/vendor/bootstrap-icons/font/bootstrap-icons.min.css?v={{ STATIC_VER }}">
    <link rel="stylesheet" href="/static/css/talamala-design-system.css?v={{ STATIC_VER }}">
    <link rel="stylesheet" href="/static/css/bootstrap-bridge.css?v={{ STATIC_VER }}">
    <link rel="stylesheet" href="/static/css/talamala-animations.css?v={{ STATIC_VER }}">
    <style>
        body { background: linear-gradient(135deg, var(--tm-primary-100) 0%, var(--tm-primary) 100%); min-height: 100vh; }
        .verify-card { border-radius: 16px; max-width: 650px; overflow-wrap: break-word; word-break: break-word; }
        .brand-logo { color: var(--tm-primary); font-size: 1.5rem; font-weight: bold; }
        .qr-container { background: var(--tm-info-900); border-radius: 12px; padding: 1rem; display: inline-block; }
        .timeline { position: relative; padding-right: 1.5rem; }
        .timeline::before { content: ''; position: absolute; right: 0.4rem; top: 0; bottom: 0; width: 2px; background: var(--tm-primary); opacity: 0.3; }
        .timeline-item { position: relative; padding-bottom: 1rem; }
        .timeline-item::before { content: ''; position: absolute; right: -1.15rem; top: 0.35rem; width: 10px; height: 10px; border-radius: 50%; background: var(--tm-primary); border: 2px solid white; }
        .timeline-item:last-child { padding-bottom: 0; }
    </style>
</head>
<body class="d-flex align-items-center justify-content-center p-3">
    <div class="card-tm no-hover verify-card w-100 tm-animate-scale-in">
        <div class="p-4 p-md-5">
            <!-- Header -->
            <div class="text-center mb-4 tm-animate-fade-in-down">
                <div class="brand-logo mb-2"><i class="bi bi-gem"></i> طلاملا</div>
                <h4 class="fw-bold"><i class="bi bi-shield-check me-2"></i>اصالت‌سنجی شمش</h4>
                <p class="text-muted small">کد سریال درج شده روی شمش را وارد کنید یا QR کد آن را اسکن نمایید.</p>
            </div>

            <!-- Search Form -->
            <form method="GET" action="/verify/check" class="mb-4">
                <div class="input-group input-group-lg">
                    <input type="text" name="code" class="form-control form-control-tm text-center" dir="ltr"
                           value="{{ code }}" placeholder="کد سریال"
                           style="font-family: monospace; letter-spacing: 2px; font-size: clamp(0.9rem, 3.5vw, 1.3rem);"
                           autofocus>
                    <button class="btn btn-tm-warning fw-bold px-4" type="submit">
                        <i class="bi bi-search me-1"></i>بررسی
                    </button>
                </div>
            </form>

            <!-- Result -->
            {% if result %}
                {% if result.valid %}
                <div class="alert-tm-success">
                    <div class="text-center mb-3">
                        <i class="bi bi-patch-check-fill text-success" style="font-size: 3rem;"></i>
                        <h5 class="fw-bold mt-2 text-success">شمش اصل تایید شد</h5>
                    </div>

                    <!-- Bar Info + QR Code -->
                    <div class="row">
                        <div class="col-md-7">
                            <table class="table table-tm table-sm table-borderless mb-0">
                                <tr><td class="text-muted" width="35%">کد سریال</td><td><code class="fw-bold fs-5">{{ result.serial }}</code></td></tr>
                                <tr><td class="text-muted">محصول</td><td class="fw-bold">{{ result.product_name }}</td></tr>
                                <tr><td class="text-muted">وزن</td><td>{{ result.weight }} گرم</td></tr>
                                <tr><td class="text-muted">عیار</td><td>{{ result.purity }}</td></tr>
                                <tr>
                                    <td class="text-muted">وضعیت</td>
                                    <td><span class="badge-tm badge-tm-{{ result.status_color }}">{{ result.status_label }}</span></td>
                                </tr>
                                <tr><td class="text-muted">محل نگهداری</td><td>{{ result.location }}</td></tr>
                                <tr><td class="text-muted">بچ تولید</td><td>{{ result.batch_code }}</td></tr>
                                {% if result.created_at %}
                                <tr><td class="text-muted">تاریخ ثبت</td><td>{{ result.created_at | jdate }}</td></tr>
                                {% endif %}
                            </table>
                        </div>
                        <div class="col-md-5 text-center mt-3 mt-md-0">
                            <div class="qr-container">
                                <img src="/verify/qr/{{ result.serial }}.png" alt="QR Code" width="160" height="160" class="img-fluid">
                                <div class="mt-2 small text-muted">QR کد اصالت</div>
                            </div>
                        </div>
                    </div>

                    <!-- Ownership History -->
                    {% if result.history %}
                    <hr class="my-3">
                    <h6 class="fw-bold mb-3"><i class="bi bi-clock-history me-1"></i>تاریخچه مالکیت</h6>
                    <div class="timeline">
                        {% for h in result.history %}
                        <div class="timeline-item">
                            <div class="small text-muted">{{ h.date | jdate }}</div>
                            <div class="fw-bold">{{ h.description }}</div>
                            <div class="small">
                                <span class="text-muted">از:</span> {{ h.from_owner }}
                                <i class="bi bi-arrow-left-short"></i>
                                <span class="text-muted">به:</span> {{ h.to_owner }}
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    {% endif %}
                </div>
                {% else %}
                <div class="alert-tm-danger text-center">
                    <i class="bi bi-x-octagon-fill text-danger" style="font-size: 3rem;"></i>
                    <h5 class="fw-bold mt-2 text-danger">شمش یافت نشد</h5>
                    <p class="text-muted mb-0">کد سریال <code>{{ result.serial }}</code> در سامانه طلاملا ثبت نشده است.</p>
                    <p class="small text-muted mt-2">اگر شمش را از مرکز معتبر خریداری کرده‌اید، لطفا با پشتیبانی تماس بگیرید.</p>
                </div>
                {% endif %}
            {% endif %}

            <!-- Action Buttons -->
            <div class="d-flex flex-column flex-sm-row justify-content-center gap-2 mt-4">
                <a href="/claim-bar" class="btn btn-tm-primary btn-sm">
                    <i class="bi bi-qr-code me-1"></i>ثبت مالکیت شمش
                </a>
                <a href="/my-bars" class="btn btn-tm-outline btn-sm">
                    <i class="bi bi-arrow-left-right me-1"></i>انتقال مالکیت شمش
                </a>
            </div>

            <!-- Footer -->
            <div class="text-center mt-4 pt-3 border-top">
                <a href="/" class="text-muted text-decoration-none small"><i class="bi bi-shop me-1"></i>بازگشت به فروشگاه طلاملا</a>
            </div>
        </div>
    </div>
</body>
</html>
