{% extends "admin/base_admin.html" %}
{% block title %}کیف پول مشتریان - مدیریت{% endblock %}

{% block content %}
<div class="page-header tm-animate-fade-in">
    <h4><i class="bi bi-wallet2 me-2"></i>کیف پول مشتریان</h4>
    <a href="/admin/wallets/withdrawals/list" class="btn btn-tm-warning">
        <i class="bi bi-bank me-1"></i> درخواست‌های برداشت
        {% if stats.pending_withdrawals > 0 %}
        <span class="badge-tm badge-tm-danger ms-1">{{ stats.pending_withdrawals }}</span>
        {% endif %}
    </a>
</div>

<!-- Stats Cards -->
<div class="row g-3 mb-4">
    <div class="col-md-3 tm-animate-fade-in-up tm-delay-1">
        <div class="card-tm no-hover text-center p-3">
            <div class="text-muted small">تعداد حساب‌ها</div>
            <div class="fw-bold fs-4">{{ stats.total_accounts }}</div>
        </div>
    </div>
    <div class="col-md-3 tm-animate-fade-in-up tm-delay-2">
        <div class="card-tm no-hover text-center p-3">
            <div class="text-muted small">مجموع موجودی</div>
            <div class="fw-bold fs-4 text-success">{{ stats.total_balance | toman }}</div>
            <small class="text-muted">تومان</small>
        </div>
    </div>
    <div class="col-md-3 tm-animate-fade-in-up tm-delay-3">
        <div class="card-tm no-hover text-center p-3">
            <div class="text-muted small">مجموع بلوکه</div>
            <div class="fw-bold fs-4 text-warning">{{ stats.total_locked | toman }}</div>
            <small class="text-muted">تومان</small>
        </div>
    </div>
    <div class="col-md-3 tm-animate-fade-in-up tm-delay-4">
        <div class="card-tm no-hover text-center p-3">
            <div class="text-muted small">برداشت‌های معلق</div>
            <div class="fw-bold fs-4 text-danger">{{ stats.pending_withdrawals }}</div>
        </div>
    </div>
</div>

<!-- Accounts Table -->
<div class="card-tm no-hover tm-animate-fade-in-up tm-delay-5">
    <div class="p-0">
        {% if accounts %}
        <table class="table table-tm mb-0 align-middle">
            <thead>
                <tr>
                    <th style="width:50px;">#</th>
                    <th>مشتری</th>
                    <th>موبایل</th>
                    <th>موجودی (تومان)</th>
                    <th>بلوکه (تومان)</th>
                    <th>قابل برداشت</th>
                    <th style="width:100px;"></th>
                </tr>
            </thead>
            <tbody>
                {% for acct in accounts %}
                <tr>
                    <td class="text-muted">{{ acct.id }}</td>
                    <td>
                        <strong>{{ acct.customer.full_name if acct.customer else '—' }}</strong>
                    </td>
                    <td>
                        <code>{{ acct.customer.mobile if acct.customer else '—' }}</code>
                    </td>
                    <td class="fw-bold text-success">{{ acct.balance | toman }}</td>
                    <td class="text-warning">{{ acct.locked_balance | toman }}</td>
                    <td>{{ acct.available_balance | toman }}</td>
                    <td>
                        <a href="/admin/wallets/{{ acct.customer_id }}"
                           class="btn btn-sm btn-tm-outline">
                            <i class="bi bi-eye"></i>
                        </a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        {% from "components/pagination.html" import pagination %}
        {{ pagination(page, total_pages, '/admin/wallets') }}

        {% else %}
        <div class="text-center text-muted py-5">
            <i class="bi bi-wallet" style="font-size:2rem;"></i>
            <p class="mt-2">هنوز حسابی ایجاد نشده</p>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}
