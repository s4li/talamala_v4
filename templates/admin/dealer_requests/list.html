{% extends "admin/base_admin.html" %}
{% set active_page = "dealer_requests" %}
{% block title %}درخواست نمایندگی - پنل مدیریت{% endblock %}

{% block content %}
<div class="d-flex align-items-center justify-content-between mb-4 tm-animate-fade-in">
    <h4 class="mb-0 fw-bold">
        <i class="bi bi-shop-window text-tm-primary"></i>
        درخواست‌های نمایندگی
    </h4>
</div>

<!-- Stats Row -->
<div class="row g-3 mb-4 tm-animate-fade-in-up">
    <div class="col-6 col-md-3">
        <div class="card-tm no-hover text-center py-3">
            <div class="fs-4 fw-bold">{{ stats.total }}</div>
            <small class="text-muted">کل درخواست‌ها</small>
        </div>
    </div>
    <div class="col-6 col-md-3">
        <div class="card-tm no-hover text-center py-3" style="border-right:3px solid var(--tm-warning);">
            <div class="fs-4 fw-bold text-warning">{{ stats.Pending }}</div>
            <small class="text-muted">در انتظار</small>
        </div>
    </div>
    <div class="col-6 col-md-3">
        <div class="card-tm no-hover text-center py-3" style="border-right:3px solid var(--tm-success);">
            <div class="fs-4 fw-bold text-success">{{ stats.Approved }}</div>
            <small class="text-muted">تایید شده</small>
        </div>
    </div>
    <div class="col-6 col-md-3">
        <div class="card-tm no-hover text-center py-3" style="border-right:3px solid var(--tm-danger);">
            <div class="fs-4 fw-bold text-danger">{{ stats.Rejected }}</div>
            <small class="text-muted">رد شده</small>
        </div>
    </div>
</div>

<!-- Filter Tabs -->
<div class="d-flex align-items-center gap-2 mb-3 flex-wrap tm-animate-fade-in-up tm-delay-1">
    <div class="btn-group btn-group-sm">
        <a href="/admin/dealer-requests" class="btn {% if not current_status %}btn-tm-primary{% else %}btn-tm-outline{% endif %}">
            همه
        </a>
        <a href="/admin/dealer-requests?status=Pending" class="btn {% if current_status == 'Pending' %}btn-tm-primary{% else %}btn-tm-outline{% endif %}">
            در انتظار
        </a>
        <a href="/admin/dealer-requests?status=Approved" class="btn {% if current_status == 'Approved' %}btn-tm-primary{% else %}btn-tm-outline{% endif %}">
            تایید شده
        </a>
        <a href="/admin/dealer-requests?status=Rejected" class="btn {% if current_status == 'Rejected' %}btn-tm-primary{% else %}btn-tm-outline{% endif %}">
            رد شده
        </a>
    </div>

    <!-- Search -->
    <form method="GET" action="/admin/dealer-requests" class="d-flex gap-2 ms-auto">
        {% if current_status %}<input type="hidden" name="status" value="{{ current_status }}">{% endif %}
        <input type="text" name="search" class="form-control form-control-sm form-control-tm"
               value="{{ search }}" placeholder="جستجو نام یا موبایل..." style="width:200px;">
        <button class="btn btn-sm btn-tm-outline"><i class="bi bi-search"></i></button>
    </form>
</div>

<!-- Table -->
<div class="card-tm no-hover tm-animate-fade-in-up tm-delay-2">
    {% if items %}
    <div class="table-responsive">
        <table class="table table-hover align-middle mb-0">
            <thead>
                <tr class="small text-muted">
                    <th>#</th>
                    <th>نام</th>
                    <th>موبایل</th>
                    <th>استان / شهر</th>
                    <th>تاریخ</th>
                    <th>وضعیت</th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                {% for item in items %}
                <tr>
                    <td class="small text-muted">{{ item.id }}</td>
                    <td class="fw-bold">{{ item.full_name }}</td>
                    <td dir="ltr" class="small">{{ item.mobile }}</td>
                    <td class="small">{{ item.province_name }} / {{ item.city_name }}</td>
                    <td class="small">{{ item.created_at | jdate }}</td>
                    <td>
                        <span class="badge-tm badge-tm-{{ item.status_color }}">{{ item.status_label }}</span>
                    </td>
                    <td>
                        <a href="/admin/dealer-requests/{{ item.id }}" class="btn btn-sm btn-tm-outline">
                            <i class="bi bi-eye"></i>
                        </a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Pagination -->
    {% if total_pages > 1 %}
    <nav class="mt-3">
        <ul class="pagination pagination-sm justify-content-center mb-0">
            {% for p in range(1, total_pages + 1) %}
            <li class="page-item {% if p == page %}active{% endif %}">
                <a class="page-link" href="/admin/dealer-requests?page={{ p }}{% if current_status %}&status={{ current_status }}{% endif %}{% if search %}&search={{ search }}{% endif %}">{{ p }}</a>
            </li>
            {% endfor %}
        </ul>
    </nav>
    {% endif %}

    {% else %}
    <div class="text-center py-5 text-muted">
        <i class="bi bi-inbox" style="font-size:2.5rem;opacity:0.4;"></i>
        <p class="mt-2">درخواستی یافت نشد.</p>
    </div>
    {% endif %}
</div>
{% endblock %}
