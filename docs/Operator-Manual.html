<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>راهنمای اپراتور سیستم طلاملا v4</title>
<link href="/static/vendor/vazirmatn/Vazirmatn-font-face.css" rel="stylesheet">
<style>
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body {
    font-family: 'Vazirmatn', Tahoma, sans-serif;
    font-size: 13px;
    line-height: 1.9;
    color: #1a1a1a;
    background: #fff;
    padding: 30px 40px;
    max-width: 210mm;
    margin: 0 auto;
  }
  h1 {
    font-size: 22px;
    color: #b8860b;
    border-bottom: 3px solid #b8860b;
    padding-bottom: 10px;
    margin-bottom: 6px;
  }
  h1 + blockquote {
    font-size: 11px;
    color: #666;
    border-right: 3px solid #daa520;
    padding: 8px 12px;
    margin-bottom: 20px;
    background: #fffdf5;
  }
  h2 {
    font-size: 17px;
    color: #8b6914;
    margin-top: 28px;
    margin-bottom: 10px;
    padding-bottom: 5px;
    border-bottom: 2px solid #e8d8a0;
    page-break-after: avoid;
  }
  h3 {
    font-size: 14px;
    color: #333;
    margin-top: 16px;
    margin-bottom: 6px;
    page-break-after: avoid;
  }
  h4 { font-size: 13px; color: #444; margin-top: 12px; margin-bottom: 4px; }
  p { margin-bottom: 8px; text-align: justify; }
  ul, ol { margin: 6px 20px 10px 0; padding-right: 16px; }
  li { margin-bottom: 3px; }
  strong { color: #333; }
  code {
    font-family: Consolas, 'Courier New', monospace;
    background: #f5f0e0;
    padding: 1px 5px;
    border-radius: 3px;
    font-size: 11px;
    direction: ltr;
    unicode-bidi: embed;
  }
  pre {
    background: #f8f6f0;
    border: 1px solid #e0d8c0;
    border-radius: 6px;
    padding: 12px;
    margin: 8px 0 12px;
    overflow-x: auto;
    direction: ltr;
    text-align: left;
    font-size: 11px;
    line-height: 1.6;
  }
  pre code { background: none; padding: 0; }
  table {
    width: 100%;
    border-collapse: collapse;
    margin: 10px 0 14px;
    font-size: 12px;
    page-break-inside: avoid;
  }
  th, td {
    border: 1px solid #d4c89a;
    padding: 6px 10px;
    text-align: right;
  }
  th {
    background: #f5efd5;
    font-weight: 700;
    color: #5a4a1a;
  }
  tr:nth-child(even) { background: #fdfbf5; }
  hr {
    border: none;
    border-top: 1px solid #e0d8c0;
    margin: 20px 0;
  }
  .toc {
    background: #faf8f0;
    border: 1px solid #e0d8c0;
    border-radius: 8px;
    padding: 16px 20px;
    margin: 16px 0 24px;
  }
  .toc h3 { margin-top: 0; color: #8b6914; font-size: 15px; }
  .toc ol { margin: 8px 16px 0 0; }
  .toc li { margin-bottom: 2px; }
  .toc a { color: #8b6914; text-decoration: none; }
  .note {
    background: #fff8e0;
    border-right: 4px solid #daa520;
    padding: 8px 12px;
    margin: 8px 0;
    border-radius: 0 6px 6px 0;
    font-size: 12px;
  }
  .danger {
    background: #fff0f0;
    border-right: 4px solid #dc3545;
    padding: 8px 12px;
    margin: 8px 0;
    border-radius: 0 6px 6px 0;
    font-size: 12px;
  }
  .lifecycle {
    background: #f8f6f0;
    border: 1px solid #e0d8c0;
    border-radius: 8px;
    padding: 16px;
    margin: 10px 0;
    font-family: 'Vazirmatn', monospace;
    font-size: 13px;
    line-height: 2;
    direction: rtl;
    text-align: center;
  }
  .footer {
    margin-top: 30px;
    padding-top: 12px;
    border-top: 2px solid #e0d8c0;
    text-align: center;
    font-size: 11px;
    color: #999;
  }
  @media print {
    body { padding: 15px 20px; font-size: 11px; }
    h1 { font-size: 18px; }
    h2 { font-size: 15px; margin-top: 20px; }
    h3 { font-size: 13px; }
    .toc { page-break-after: always; }
    h2 { page-break-before: auto; }
    table, pre, .lifecycle { page-break-inside: avoid; }
    .no-print { display: none; }
  }
</style>
</head>
<body>

<h1>راهنمای اپراتور سیستم طلاملا v4</h1>
<blockquote>
این سند برای اپراتورهای غیرفنی نوشته شده و تمام عملیات روزانه را قدم‌به‌قدم توضیح می‌دهد.<br>
پیش‌نیاز: داشتن حساب اپراتور (نقش operator یا super_admin).
</blockquote>

<div class="toc">
<h3>فهرست مطالب</h3>
<ol>
  <li><a href="#sec1">شروع سریع</a></li>
  <li><a href="#sec2">سناریو ۱: مدیریت انبار و شمش‌ها</a></li>
  <li><a href="#sec3">سناریو ۲: فرآیند فروش و سفارشات</a></li>
  <li><a href="#sec4">سناریو ۳: مدیریت نمایندگان</a></li>
  <li><a href="#sec5">سناریو ۴: مدیریت کوپن‌ها</a></li>
  <li><a href="#sec6">سناریو ۵: احراز اصالت و کیف پول</a></li>
  <li><a href="#sec7">سناریو ۶: مدیریت تیکت‌های پشتیبانی</a></li>
  <li><a href="#sec8">سناریو ۷: مدیریت کلید API دستگاه POS</a></li>
  <li><a href="#sec9">سناریو ۸: صفحات ثابت و فوتر</a></li>
  <li><a href="#sec10">سناریو ۹: ثبت مالکیت، خرید هدیه و انتقال شمش</a></li>
  <li><a href="#sec11">عیب‌یابی (Troubleshooting)</a></li>
  <li><a href="#sec12">واژه‌نامه</a></li>
</ol>
</div>

<!-- ==================== Section 1 ==================== -->
<h2 id="sec1">۱. شروع سریع</h2>

<h3>نحوه ورود به پنل مدیریت</h3>
<ol>
  <li>مرورگر را باز کنید و به آدرس سایت بروید (مثلاً <code>http://127.0.0.1:8000</code>)</li>
  <li>روی «ورود» کلیک کنید یا مستقیم به <code>/auth/login</code> بروید</li>
  <li>شماره موبایل اپراتور خود را وارد کنید</li>
  <li>کد OTP دریافتی از SMS را وارد کنید</li>
  <li>سیستم شما را به <strong>داشبورد مدیریت</strong> هدایت می‌کند</li>
</ol>

<h3>آشنایی با داشبورد</h3>
<p>پس از ورود، داشبورد شامل موارد زیر است:</p>
<ul>
  <li><strong>کارت‌های آماری بالا:</strong> درآمد کل، تعداد سفارشات، تعداد مشتریان، تعداد شمش‌ها</li>
  <li><strong>کارت‌های آماری دوم:</strong> سفارش امروز، درآمد امروز، در انتظار پرداخت، شمش موجود، نماینده فعال، درخواست برداشت</li>
  <li><strong>نمودار درآمد:</strong> نمودار خطی درآمد ۳۰ روز اخیر</li>
  <li><strong>نمودار موجودی:</strong> نمودار دایره‌ای وضعیت شمش‌ها</li>
  <li><strong>آخرین سفارشات:</strong> جدول ۱۰ سفارش اخیر</li>
  <li><strong>دسترسی سریع:</strong> لینک به بخش‌های مختلف</li>
  <li><strong>قیمت طلا:</strong> قیمت فعلی طلای ۱۸ عیار</li>
  <li><strong>هشدارها:</strong> تعداد موارد در انتظار بررسی</li>
</ul>

<h3>منوی کناری (Sidebar)</h3>
<table>
  <thead><tr><th>بخش</th><th>آدرس</th><th>توضیح</th></tr></thead>
  <tbody>
    <tr><td>داشبورد</td><td><code>/admin/dashboard</code></td><td>صفحه اصلی مدیریت</td></tr>
    <tr><td>محصولات</td><td><code>/admin/products</code></td><td>مدیریت محصولات (شمش‌ها)</td></tr>
    <tr><td>دسته‌بندی</td><td><code>/admin/categories</code></td><td>دسته‌بندی محصولات</td></tr>
    <tr><td>طرح کارت</td><td><code>/admin/designs</code></td><td>طرح‌های کارت هدیه</td></tr>
    <tr><td>بسته‌بندی</td><td><code>/admin/packages</code></td><td>انواع بسته‌بندی</td></tr>
    <tr><td>بچ‌ها</td><td><code>/admin/batches</code></td><td>بچ‌های تولید</td></tr>
    <tr><td>شمش‌ها</td><td><code>/admin/bars</code></td><td>انبارداری شمش</td></tr>
    <tr><td>مکان‌ها</td><td><code>/admin/locations</code></td><td>مکان‌های فیزیکی</td></tr>
    <tr><td>سفارشات</td><td><code>/admin/orders</code></td><td>مدیریت سفارشات</td></tr>
    <tr><td>کیف پول</td><td><code>/admin/wallets</code></td><td>حساب‌های کیف پول</td></tr>
    <tr><td>برداشت‌ها</td><td><code>/admin/wallets/withdrawals/list</code></td><td>درخواست‌های برداشت</td></tr>
    <tr><td>کوپن‌ها</td><td><code>/admin/coupons</code></td><td>مدیریت کوپن تخفیف</td></tr>
    <tr><td>نمایندگان</td><td><code>/admin/dealers</code></td><td>مدیریت نمایندگان</td></tr>
    <tr><td>بازخرید</td><td><code>/admin/dealers/buybacks</code></td><td>درخواست‌های بازخرید</td></tr>
    <tr><td>تیکت‌ها</td><td><code>/admin/tickets</code></td><td>تیکت‌های پشتیبانی</td></tr>
    <tr><td>تنظیمات</td><td><code>/admin/settings</code></td><td>تنظیمات سیستم (فقط مدیرکل)</td></tr>
  </tbody>
</table>

<hr>

<!-- ==================== Section 2 ==================== -->
<h2 id="sec2">۲. سناریو ۱: مدیریت انبار و شمش‌ها</h2>

<h3>۲.۱ ایجاد مکان جدید</h3>
<p><strong>کی لازم است؟</strong> وقتی شعبه یا انبار جدیدی راه‌اندازی می‌شود.</p>
<ol>
  <li>از منو <strong>مکان‌ها</strong> را انتخاب کنید</li>
  <li>روی <strong>«ایجاد مکان جدید»</strong> کلیک کنید</li>
  <li>فرم را پر کنید:
    <ul>
      <li><strong>نام:</strong> مثلاً «نمایندگی اصفهان»</li>
      <li><strong>نوع:</strong> یکی از: کارخانه، انبار مرکزی، نمایندگی، پلتفرم آنلاین</li>
      <li><strong>استان و شهر:</strong> محل فیزیکی</li>
      <li><strong>آدرس:</strong> آدرس کامل</li>
      <li><strong>تلفن:</strong> شماره تماس</li>
      <li><strong>هاب پستی:</strong> اگر از این مکان ارسال پستی انجام می‌شود، تیک بزنید</li>
    </ul>
  </li>
  <li>دکمه <strong>«ذخیره»</strong> را بزنید</li>
</ol>

<h3>۲.۲ ایجاد و ویرایش محصول</h3>
<p><strong>کی لازم است؟</strong> وقتی محصول جدیدی (نوع شمش) به سیستم اضافه می‌شود یا مشخصات محصول موجود تغییر می‌کند.</p>
<ol>
  <li>از منو <strong>محصولات</strong> را انتخاب کنید</li>
  <li>برای ایجاد: روی <strong>«ایجاد محصول جدید»</strong> کلیک کنید</li>
  <li>برای ویرایش: روی <strong>«ویرایش»</strong> کنار محصول کلیک کنید</li>
  <li>فرم را پر کنید:
    <ul>
      <li><strong>نام:</strong> نام محصول (مثلاً «شمش ۱ گرمی ۱۸ عیار»)</li>
      <li><strong>دسته‌بندی‌ها:</strong> با چک‌باکس یک یا چند دسته‌بندی انتخاب کنید</li>
      <li><strong>وزن:</strong> وزن شمش (گرم)</li>
      <li><strong>عیار:</strong> خلوص طلا (۷۵۰ = ۱۸ عیار)</li>
      <li><strong>اجرت ساخت:</strong> درصدی (از ارزش طلای خام)</li>
    </ul>
  </li>
  <li><strong>«ذخیره»</strong> را بزنید</li>
</ol>
<div class="note"><strong>نکته مهم درباره دسته‌بندی‌ها:</strong> حداقل یک دسته‌بندی باید انتخاب شود. محصولاتی که در چند دسته‌بندی هستند، هنگام فیلتر بر اساس هر یک از دسته‌بندی‌هایشان در فروشگاه نمایش داده می‌شوند.</div>

<h3>۲.۳ ثبت شمش جدید</h3>
<p><strong>کی لازم است؟</strong> وقتی شمش‌های جدید از کارخانه دریافت می‌شوند.</p>
<div class="note"><strong>توجه:</strong> شمش‌ها معمولاً از طریق <code>seed.py</code> یا ایمپورت دسته‌ای وارد سیستم می‌شوند. مدیریت تکی شمش‌ها از طریق صفحه ویرایش انجام می‌شود.</div>

<h3>۲.۴ مشاهده و فیلتر شمش‌ها</h3>
<ol>
  <li>از منو <strong>شمش‌ها</strong> را انتخاب کنید</li>
  <li>فیلترهای موجود:
    <ul>
      <li><strong>وضعیت:</strong> خام (Raw)، تخصیص (Assigned)، رزرو (Reserved)، فروخته (Sold)</li>
      <li><strong>جستجو:</strong> بر اساس سریال‌کد</li>
    </ul>
  </li>
  <li>هر ردیف نمایش می‌دهد: سریال‌کد، محصول، وضعیت، مکان، مشتری</li>
</ol>

<h3>۲.۵ ویرایش شمش</h3>
<ol>
  <li>در لیست شمش‌ها روی <strong>«ویرایش»</strong> کلیک کنید</li>
  <li>می‌توانید تغییر دهید:
    <ul>
      <li><strong>محصول تخصیص‌یافته:</strong> کدام محصول به این شمش وصل است</li>
      <li><strong>مکان:</strong> شمش در کدام انبار/شعبه است</li>
      <li><strong>بچ تولید:</strong> متعلق به کدام ذوب</li>
      <li><strong>طرح کارت:</strong> طرح بسته‌بندی</li>
      <li><strong>نوع بسته‌بندی:</strong> نوع جعبه</li>
    </ul>
  </li>
  <li><strong>ذخیره</strong> کنید</li>
</ol>

<h3>۲.۶ چرخه حیات شمش</h3>
<div class="lifecycle">
خام (Raw)<br>
↓ &nbsp;تخصیص محصول<br>
تخصیص (Assigned) &nbsp;← آماده فروش<br>
↓ &nbsp;مشتری به سبد اضافه می‌کند<br>
رزرو (Reserved) &nbsp;← در سبد خرید<br>
↓ پرداخت موفق &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;↓ لغو / تایم‌اوت<br>
فروخته (Sold) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; تخصیص (Assigned)
</div>

<hr>

<!-- ==================== Section 3 ==================== -->
<h2 id="sec3">۳. سناریو ۲: فرآیند فروش و سفارشات</h2>

<h3>۳.۱ جریان خرید مشتری (آنلاین)</h3>
<p>مشتری این مراحل را طی می‌کند:</p>
<ol>
  <li>ورود به فروشگاه → مشاهده محصولات</li>
  <li>افزودن محصول به سبد خرید</li>
  <li>صفحه چک‌اوت: انتخاب روش تحویل (حضوری / پستی) + وارد کردن کوپن تخفیف (اختیاری)</li>
  <li>پرداخت (کیف پول یا درگاه بانکی)</li>
  <li>دریافت سفارش</li>
</ol>

<h3>۳.۲ مدیریت سفارشات (اپراتور)</h3>
<ol>
  <li>از منو <strong>سفارشات</strong> را انتخاب کنید</li>
  <li>فیلتر بر اساس وضعیت: همه، در انتظار، پرداخت شده، ارسال شده، تحویل شده، لغو شده</li>
  <li>هر ردیف نمایش می‌دهد: شماره سفارش، نام مشتری، مبلغ، وضعیت، روش تحویل، تاریخ</li>
</ol>

<h3>۳.۳ تغییر وضعیت سفارش</h3>
<p><strong>پس از پرداخت و آماده‌سازی شمش:</strong></p>
<ol>
  <li>سفارش را پیدا کنید (وضعیت: پرداخت شده)</li>
  <li>شمش‌ها را آماده و بسته‌بندی کنید</li>
  <li>وضعیت ارسال را به‌روزرسانی کنید:
    <ul>
      <li><strong>حضوری:</strong> هماهنگی با نمایندگی برای تحویل</li>
      <li><strong>پستی:</strong> ثبت کد پیگیری پستی</li>
    </ul>
  </li>
</ol>

<h3>۳.۴ استرداد سفارش</h3>
<div class="note"><strong>توجه:</strong> استرداد فقط توسط ادمین قابل انجام است.</div>
<ol>
  <li>سفارش مورد نظر را باز کنید</li>
  <li>دکمه <strong>«استرداد»</strong> را بزنید</li>
  <li>مبلغ به کیف پول مشتری برگشت داده می‌شود</li>
  <li>شمش‌ها آزاد شده و به وضعیت قبلی برمی‌گردند</li>
</ol>

<h3>۳.۵ دلیل لغو سفارش</h3>
<p>هنگام لغو سفارش، دلیل لغو به‌صورت خودکار ثبت و در جزئیات سفارش نمایش داده می‌شود:</p>
<ul>
  <li><strong>لغو توسط مشتری:</strong> مشتری خودش سفارش را لغو کرده</li>
  <li><strong>لغو توسط مدیر سیستم:</strong> مدیر از پنل ادمین سفارش را لغو کرده</li>
  <li><strong>عدم پرداخت در مهلت مقرر:</strong> سیستم به‌صورت خودکار بعد از اتمام زمان رزرو لغو کرده</li>
  <li><strong>استرداد وجه توسط مدیر:</strong> مدیر سفارش پرداخت‌شده را استرداد و لغو کرده</li>
</ul>

<hr>

<!-- ==================== Section 4 ==================== -->
<h2 id="sec4">۴. سناریو ۳: مدیریت نمایندگان</h2>

<h3>۴.۱ ایجاد نماینده جدید</h3>
<ol>
  <li>از منو <strong>نمایندگان</strong> را انتخاب کنید</li>
  <li>روی <strong>«ایجاد نماینده جدید»</strong> کلیک کنید</li>
  <li>فرم را پر کنید:
    <ul>
      <li><strong>شماره موبایل:</strong> شماره ۱۱ رقمی (09xxxxxxxxx)</li>
      <li><strong>نام کامل:</strong> نام و نام خانوادگی</li>
      <li><strong>کد ملی:</strong> اختیاری (۱۰ رقمی)</li>
      <li><strong>محل نمایندگی:</strong> انتخاب از لیست مکان‌ها</li>
      <li><strong>درصد کمیسیون:</strong> پیش‌فرض ۲٪</li>
    </ul>
  </li>
  <li><strong>«ایجاد نماینده»</strong> را بزنید</li>
</ol>

<h3>۴.۲ ویرایش نماینده</h3>
<ol>
  <li>در لیست نمایندگان روی <strong>«ویرایش»</strong> کلیک کنید</li>
  <li>قابل تغییر: نام کامل، محل نمایندگی، درصد کمیسیون، وضعیت فعال/غیرفعال</li>
  <li><strong>«ذخیره تغییرات»</strong> را بزنید</li>
</ol>
<div class="note"><strong>نکته:</strong> غیرفعال کردن نماینده مانع از ورود او به پنل نمایندگی می‌شود.</div>

<h3>۴.۳ بررسی درخواست‌های بازخرید</h3>
<p><strong>بازخرید چیست؟</strong> وقتی مشتری می‌خواهد شمشی را که قبلاً خریده به فروشنده برگرداند و پول خود را دریافت کند.</p>
<ol>
  <li>از منو <strong>بازخرید نمایندگان</strong> را انتخاب کنید</li>
  <li>فیلتر بر اساس وضعیت: همه، در انتظار، تایید شده، رد شده</li>
  <li>برای هر درخواست «در انتظار» دو دکمه وجود دارد:
    <ul>
      <li><strong>تایید:</strong> سیستم یادداشت اختیاری می‌خواهد → تایید درخواست</li>
      <li><strong>رد:</strong> سیستم دلیل رد را می‌خواهد → رد درخواست</li>
    </ul>
  </li>
</ol>

<h3>۴.۴ تایید بازخرید با بازگشت اجرت (Buyback Wage Refund)</h3>
<p><strong>چه زمانی اتفاق می‌افتد؟</strong> وقتی نماینده درخواست بازخرید شمشی را ثبت می‌کند که قبلاً به یک مشتری ثبت‌نام‌شده فروخته شده است.</p>
<ol>
  <li>از منو <strong>بازخرید نمایندگان</strong> (<code>/admin/dealers/buybacks</code>) را انتخاب کنید</li>
  <li>درخواست بازخرید «در انتظار» مورد نظر را پیدا کنید</li>
  <li>دکمه <strong>«تایید»</strong> را بزنید</li>
  <li>در صورت نیاز یادداشت ادمین وارد کنید (اختیاری)</li>
  <li>سیستم به‌صورت خودکار:
    <ul>
      <li>وضعیت شمش از <strong>SOLD</strong> به <strong>ASSIGNED</strong> تغییر می‌کند</li>
      <li>مالکیت شمش حذف می‌شود</li>
      <li>رکورد OwnershipHistory ثبت می‌شود</li>
      <li>اجرت اصلی به‌عنوان <strong>اعتبار فروشگاهی غیرقابل برداشت</strong> به کیف پول مشتری واریز می‌شود</li>
    </ul>
  </li>
</ol>

<div class="note">
<strong>حالات خاص:</strong><br>
- اگر شمش از طریق POS فروخته شده باشد (بدون OrderItem): بازگشت اجرت انجام نمی‌شود.<br>
- اگر شمش فاقد customer_id باشد: بازگشت اجرت انجام نمی‌شود.
</div>

<h3>۴.۵ مشاهده آمار نمایندگان</h3>
<p>در صفحه لیست نمایندگان، ۶ کارت آماری بالای صفحه:</p>
<ul>
  <li>تعداد کل نمایندگان</li>
  <li>نمایندگان فعال</li>
  <li>کل فروش حضوری</li>
  <li>درآمد فروش حضوری</li>
  <li>کل کمیسیون پرداختی</li>
  <li>درخواست‌های بازخرید در انتظار</li>
</ul>

<hr>

<!-- ==================== Section 5 ==================== -->
<h2 id="sec5">۵. سناریو ۴: مدیریت کوپن‌ها</h2>

<h3>۵.۱ ایجاد کوپن تخفیف</h3>
<ol>
  <li>از منو <strong>کوپن‌ها</strong> را انتخاب کنید</li>
  <li>روی <strong>«ایجاد کوپن جدید»</strong> کلیک کنید</li>
  <li>فیلدهای اصلی:
    <ul>
      <li><strong>کد کوپن:</strong> کدی که مشتری وارد می‌کند (مثلاً WELCOME10)</li>
      <li><strong>عنوان:</strong> نام نمایشی</li>
      <li><strong>نوع:</strong> تخفیف (DISCOUNT) یا کشبک (CASHBACK)</li>
      <li><strong>حالت تخفیف:</strong> درصدی (PERCENT) یا مبلغ ثابت (FIXED)</li>
      <li><strong>مقدار تخفیف:</strong> عدد درصد یا مبلغ (تومان)</li>
    </ul>
  </li>
  <li>محدودیت‌ها (اختیاری): سقف تخفیف، حداقل سفارش، سقف استفاده کل، سقف هر مشتری، تاریخ شروع/انقضا</li>
  <li>تنظیمات خاص: فقط اولین خرید، خصوصی</li>
  <li><strong>«ایجاد کوپن»</strong> را بزنید</li>
</ol>

<h3>۵.۲ تفاوت تخفیف و کشبک</h3>
<table>
  <thead><tr><th>ویژگی</th><th>تخفیف (DISCOUNT)</th><th>کشبک (CASHBACK)</th></tr></thead>
  <tbody>
    <tr><td>زمان اعمال</td><td>هنگام خرید</td><td>پس از تحویل</td></tr>
    <tr><td>نحوه اعمال</td><td>کسر از مبلغ سفارش</td><td>واریز به کیف پول</td></tr>
    <tr><td>مشتری می‌بیند</td><td>قیمت کمتر در چک‌اوت</td><td>مبلغ واریزشده در کیف پول</td></tr>
  </tbody>
</table>

<h3>۵.۳ مثال‌های کاربردی</h3>
<table>
  <thead><tr><th>مثال</th><th>کد</th><th>نوع</th><th>توضیح</th></tr></thead>
  <tbody>
    <tr><td>خوش‌آمدگویی</td><td><code>WELCOME10</code></td><td>تخفیف درصدی ۱۰٪</td><td>سقف ۲M تومان، فقط اولین خرید</td></tr>
    <tr><td>کشبک مناسبتی</td><td><code>CASHBACK5</code></td><td>کشبک درصدی ۵٪</td><td>بدون سقف، ۱۰۰ بار</td></tr>
    <tr><td>مبلغ ثابت</td><td><code>FIXED500</code></td><td>تخفیف ۵۰۰K تومان</td><td>حداقل سفارش ۵M تومان</td></tr>
    <tr><td>VIP</td><td><code>VIP2026</code></td><td>تخفیف درصدی ۱۵٪</td><td>خصوصی + لیست سفید موبایل</td></tr>
  </tbody>
</table>

<h3>۵.۴ محدودیت دسته‌بندی (کوپن تخصصی دسته)</h3>
<ol>
  <li>در فرم ایجاد/ویرایش کوپن، فیلد <strong>«محدوده کوپن»</strong> را روی <strong>«دسته‌بندی»</strong> (CATEGORY) قرار دهید</li>
  <li>دسته‌بندی‌های مورد نظر را با چک‌باکس انتخاب کنید</li>
  <li><strong>«ایجاد کوپن»</strong> یا <strong>«ذخیره تغییرات»</strong> را بزنید</li>
</ol>
<div class="note">
<strong>نحوه عملکرد:</strong> اگر سبد خرید حداقل یک محصول از دسته‌بندی‌های انتخاب‌شده داشته باشد → کوپن معتبر است. در غیر این صورت پیام خطا نمایش داده می‌شود.
</div>

<h3>۵.۵ غیرفعال کردن کوپن</h3>
<ol>
  <li>کوپن مورد نظر را باز کنید</li>
  <li>وضعیت را به <strong>«غیرفعال»</strong> تغییر دهید</li>
  <li>ذخیره کنید</li>
</ol>

<hr>

<!-- ==================== Section 6 ==================== -->
<h2 id="sec6">۶. سناریو ۵: احراز اصالت و کیف پول</h2>

<h3>۶.۱ احراز اصالت شمش</h3>
<ol>
  <li>به آدرس <code>/verify</code> بروید</li>
  <li>سریال‌کد ۸ کاراکتری شمش را وارد کنید</li>
  <li>سیستم نمایش می‌دهد: <strong>شمش اصل</strong> (نام محصول، وزن، عیار، وضعیت) یا <strong>«سریال‌کد یافت نشد»</strong></li>
</ol>

<h3>۶.۲ مدیریت حساب‌های کیف پول</h3>
<ol>
  <li>از منو <strong>کیف پول → حساب‌ها</strong> را انتخاب کنید</li>
  <li>لیست تمام حساب‌های مشتریان: نام مشتری، موجودی، مبلغ بلوکه‌شده</li>
  <li>روی هر حساب کلیک کنید تا جزئیات و تاریخچه تراکنش‌ها را ببینید</li>
</ol>

<h3>۶.۳ بررسی درخواست‌های برداشت</h3>
<ol>
  <li>از منو <strong>کیف پول → برداشت‌ها</strong> را انتخاب کنید</li>
  <li>درخواست‌های «در انتظار» را بررسی کنید: نام مشتری، مبلغ، شماره شبا، نام صاحب حساب</li>
  <li><strong>تایید:</strong> مبلغ را واریز کنید، سپس دکمه «تایید» را بزنید</li>
  <li><strong>رد:</strong> در صورت مشکل دکمه «رد» را بزنید</li>
</ol>
<div class="danger"><strong>مهم:</strong> تایید درخواست برداشت فقط به معنای تایید در سیستم است. واریز واقعی به حساب بانکی باید <strong>دستی</strong> توسط حسابدار انجام شود.</div>

<h3>۶.۴ تنظیمات سیستم (فقط مدیرکل)</h3>
<ol>
  <li>از منو <strong>تنظیمات</strong> را انتخاب کنید</li>
  <li>تنظیمات قابل تغییر:
    <ul>
      <li><strong>قیمت طلای ۱۸ عیار:</strong> مبنای محاسبه قیمت تمام محصولات</li>
      <li><strong>درصد مالیات:</strong> مالیات بر ارزش افزوده</li>
      <li><strong>هزینه ارسال:</strong> هزینه پایه ارسال پستی</li>
      <li><strong>بیمه ارسال:</strong> هزینه بیمه مرسوله</li>
    </ul>
  </li>
  <li><strong>«ذخیره»</strong> را بزنید</li>
</ol>
<div class="danger"><strong>هشدار:</strong> تغییر قیمت طلا فوراً روی قیمت تمام محصولات در فروشگاه اثر می‌گذارد.</div>

<hr>

<!-- ==================== Section 7 ==================== -->
<h2 id="sec7">۷. سناریو ۶: مدیریت تیکت‌های پشتیبانی</h2>

<h3>۷.۱ آشنایی با سیستم تیکت</h3>
<p>مشتریان و نمایندگان می‌توانند از طریق سیستم تیکت، سوالات و مشکلات خود را مطرح کنند. تیکت‌ها با <strong>تب‌های جداگانه</strong> و <strong>badge رنگی</strong> مشخص می‌شوند.</p>

<h3>۷.۲ مشاهده لیست تیکت‌ها</h3>
<ol>
  <li>از منو <strong>تیکت‌های پشتیبانی</strong> (<code>/admin/tickets</code>) را انتخاب کنید</li>
  <li>تب‌ها: <strong>همه</strong> | <strong>مشتریان</strong> (badge آبی) | <strong>نمایندگان</strong> (badge بنفش)</li>
  <li>دکمه‌های فیلتر وضعیت: باز | در حال بررسی | پاسخ داده شده | بسته</li>
  <li>جدول نمایش: نوع فرستنده، موضوع، اولویت، وضعیت، اپراتور، تعداد پیام، تاریخ</li>
</ol>

<h3>۷.۳ پاسخ دادن به تیکت</h3>
<ol>
  <li>روی تیکت مورد نظر کلیک کنید</li>
  <li>مکالمه را مشاهده کنید (پیام‌های اپراتور با پس‌زمینه سبز)</li>
  <li>در فرم پاسخ، متن خود را بنویسید و <strong>«ارسال پاسخ»</strong> را بزنید</li>
  <li>وضعیت خودکار به <strong>«پاسخ داده شده»</strong> تغییر می‌کند</li>
</ol>

<h3>۷.۴ تخصیص تیکت به اپراتور</h3>
<ol>
  <li>صفحه جزئیات تیکت → پنل کناری → قسمت <strong>«تخصیص»</strong></li>
  <li>از لیست کشویی اپراتور مورد نظر را انتخاب و <strong>«تخصیص»</strong> را بزنید</li>
</ol>

<h3>۷.۵ تغییر وضعیت تیکت</h3>
<p>از لیست کشویی <strong>«تغییر وضعیت»</strong> در پنل کناری: باز، در حال بررسی، پاسخ داده شده، بسته</p>

<h3>۷.۶ بستن تیکت</h3>
<p>دکمه <strong>«بستن تیکت»</strong> (قرمز) در پنل کناری. مشتری یا نماینده هم می‌توانند تیکت خود را ببندند.</p>

<h3>۷.۷ رفتار خودکار وضعیت</h3>
<table>
  <thead><tr><th>اقدام</th><th>تغییر وضعیت خودکار</th></tr></thead>
  <tbody>
    <tr><td>اپراتور پاسخ می‌دهد</td><td>→ پاسخ داده شده (Answered)</td></tr>
    <tr><td>مشتری/نماینده پاسخ می‌دهد (وقتی Answered)</td><td>→ باز (Open) — بازگشایی</td></tr>
    <tr><td>تخصیص به اپراتور (وقتی باز)</td><td>→ در حال بررسی (InProgress)</td></tr>
    <tr><td>اولین پاسخ اپراتور (بدون تخصیص)</td><td>→ تخصیص خودکار</td></tr>
  </tbody>
</table>

<h3>۷.۸ پیوست فایل در تیکت</h3>
<p>فرمت‌های مجاز: <strong>JPG، PNG، WEBP</strong> — حداکثر حجم: <strong>۱۰ مگابایت</strong></p>
<p>هم مشتری/نماینده و هم اپراتور می‌توانند فایل تصویری پیوست کنند.</p>

<h3>۷.۹ دسته‌بندی / دپارتمان تیکت</h3>
<table>
  <thead><tr><th>دپارتمان</th><th>توضیح</th></tr></thead>
  <tbody>
    <tr><td>مالی</td><td>پرداخت، کیف پول، استرداد</td></tr>
    <tr><td>فنی</td><td>مشکلات فنی سایت، اپلیکیشن، POS</td></tr>
    <tr><td>فروش</td><td>سوالات قبل از خرید، مشاوره محصول</td></tr>
    <tr><td>شکایات</td><td>شکایت از خدمات، محصول، نماینده</td></tr>
    <tr><td>سایر</td><td>موارد متفرقه</td></tr>
  </tbody>
</table>

<h3>۷.۱۰ یادداشت داخلی (Internal Notes)</h3>
<p>یادداشت‌هایی که <strong>فقط کارکنان می‌بینند</strong> — مشتری و نماینده دسترسی ندارند.</p>
<ol>
  <li>صفحه جزئیات تیکت را باز کنید</li>
  <li>متن یادداشت را بنویسید</li>
  <li>دکمه <strong>«یادداشت داخلی»</strong> را بزنید</li>
</ol>

<h3>۷.۱۱ جستجوی تیکت</h3>
<p>جستجو بر اساس: شماره تیکت، موضوع، نام فرستنده، شماره موبایل. جستجو با فیلترها ترکیب می‌شود.</p>

<h3>۷.۱۲ اطلاع‌رسانی پیامکی</h3>
<table>
  <thead><tr><th>رویداد</th><th>گیرنده</th><th>متن تقریبی</th></tr></thead>
  <tbody>
    <tr><td>اپراتور پاسخ می‌دهد</td><td>مشتری/نماینده</td><td>«پاسخ جدید برای تیکت #X»</td></tr>
    <tr><td>وضعیت تغییر می‌کند</td><td>مشتری/نماینده</td><td>«وضعیت تیکت #X به Y تغییر یافت»</td></tr>
  </tbody>
</table>

<hr>

<!-- ==================== Section 8 ==================== -->
<h2 id="sec8">۸. سناریو ۷: مدیریت کلید API دستگاه POS</h2>

<h3>۸.۱ آشنایی</h3>
<p>نمایندگان از دستگاه‌های POS اندرویدی برای فروش حضوری استفاده می‌کنند. هر دستگاه با <strong>کلید API</strong> احراز هویت می‌شود.</p>

<h3>۸.۲ تولید کلید API</h3>
<ol>
  <li>از منو <strong>نمایندگان</strong> → ویرایش نماینده مورد نظر</li>
  <li>بخش <strong>کلید API دستگاه POS</strong> → <strong>«تولید کلید API»</strong></li>
  <li>کلید را کپی و در اختیار نماینده قرار دهید</li>
</ol>
<div class="note"><strong>نکته:</strong> هر نماینده فقط یک کلید فعال دارد. تولید کلید جدید، کلید قبلی را باطل می‌کند.</div>

<h3>۸.۳ لغو کلید API</h3>
<p>صفحه ویرایش نماینده → بخش کلید API → <strong>«لغو کلید»</strong> → تایید</p>

<h3>۸.۴ عیب‌یابی دستگاه POS</h3>
<table>
  <thead><tr><th>مشکل</th><th>راه‌حل</th></tr></thead>
  <tbody>
    <tr><td>خطای «کلید نامعتبر»</td><td>کلید API را لغو و مجدد تولید کنید</td></tr>
    <tr><td>لیست محصولات خالی</td><td>شمش ASSIGNED در شعبه نماینده وجود داشته باشد</td></tr>
    <tr><td>فروش ثبت نمی‌شود</td><td>شمش باید ASSIGNED و در شعبه نماینده باشد</td></tr>
  </tbody>
</table>

<hr>

<!-- ==================== Section 9 ==================== -->
<h2 id="sec9">۹. سناریو ۸: صفحات ثابت و فوتر</h2>

<h3>۹.۱ صفحات موجود</h3>
<table>
  <thead><tr><th>صفحه</th><th>آدرس</th><th>توضیح</th></tr></thead>
  <tbody>
    <tr><td>درباره ما</td><td><code>/about</code></td><td>معرفی شرکت طلاملا</td></tr>
    <tr><td>سوالات متداول</td><td><code>/faq</code></td><td>سوالات پرتکرار</td></tr>
    <tr><td>تماس با ما</td><td><code>/contact</code></td><td>آدرس، تلفن، ایمیل</td></tr>
    <tr><td>قوانین و مقررات</td><td><code>/terms</code></td><td>شرایط استفاده</td></tr>
  </tbody>
</table>

<h3>۹.۲ به‌روزرسانی محتوا</h3>
<div class="note"><strong>نکته مهم:</strong> محتوای صفحات ثابت در فایل‌های قالب (Template) ذخیره شده و از طریق پنل مدیریت قابل‌ویرایش <strong>نیست</strong>. برای تغییر، درخواست به تیم فنی ارسال کنید.</div>

<h3>۹.۳ فوتر سایت</h3>
<p>شامل: اطلاعات شرکت، لینک‌های سریع، نشان‌های اعتماد، شبکه‌های اجتماعی، لینک‌های عضویت</p>

<h3>۹.۴ صفحه ۴۰۴</h3>
<p>صفحه سفارشی فارسی با دکمه بازگشت به صفحه اصلی.</p>

<hr>

<!-- ==================== Section 10 ==================== -->
<h2 id="sec10">۱۰. سناریو ۹: ثبت مالکیت، خرید هدیه و انتقال شمش</h2>

<h3>۱۰.۱ آشنایی</h3>
<p>سه قابلیت مرتبط با مالکیت شمش:</p>
<ol>
  <li><strong>کد ثبت مالکیت (Claim Code):</strong> کد ۶ کاراکتری هنگام فروش POS یا خرید هدیه</li>
  <li><strong>خرید هدیه (Gift Purchase):</strong> شمش به نام خریدار ثبت نمی‌شود</li>
  <li><strong>انتقال مالکیت (Transfer):</strong> مشتری شمش خود را به دیگری منتقل می‌کند</li>
</ol>

<h3>۱۰.۲ فروش حضوری (POS) با کد ثبت مالکیت</h3>
<ol>
  <li>نماینده فروش را در POS ثبت می‌کند</li>
  <li>سیستم خودکار کد ۶ کاراکتری تولید می‌کند</li>
  <li>کد در رسید نمایش داده / در پاسخ API برگردانده می‌شود</li>
  <li>خریدار با سریال‌کد + کد ثبت مالکیت، شمش را ثبت می‌کند</li>
</ol>

<h3>۱۰.۳ سفارش هدیه (Gift Order)</h3>
<ol>
  <li>مشتری در checkout تیک <strong>«خرید به‌عنوان هدیه»</strong> می‌زند</li>
  <li>پس از پرداخت: شمش SOLD ولی بدون مالک + کد ثبت مالکیت تولید می‌شود</li>
  <li>خریدار کد را به گیرنده می‌دهد</li>
</ol>
<div class="note"><strong>نکته بسته‌بندی:</strong> سفارش‌های هدیه با علامت «هدیه» مشخص هستند — فاکتور قیمت داخل بسته قرار ندهید.</div>

<h3>۱۰.۴ ثبت مالکیت توسط مشتری (Claim Bar)</h3>
<ol>
  <li>مشتری از منوی کاربر → «ثبت شمش» وارد فرم می‌شود</li>
  <li>سریال‌کد + کد ثبت مالکیت وارد می‌کند</li>
  <li>سیستم بررسی: سریال معتبر، کد صحیح، شمش ثبت‌نشده</li>
  <li>مالکیت ثبت می‌شود</li>
</ol>

<h3>۱۰.۵ انتقال مالکیت شمش</h3>
<ol>
  <li>مشتری از «شمش‌های من» → دکمه <strong>«انتقال»</strong></li>
  <li><strong>مرحله ۱:</strong> شماره موبایل گیرنده</li>
  <li><strong>مرحله ۲:</strong> OTP به موبایل <strong>مالک فعلی</strong> (فرستنده) ارسال می‌شود</li>
  <li><strong>مرحله ۳:</strong> تایید OTP → مالکیت منتقل می‌شود</li>
</ol>
<div class="note"><strong>نکته:</strong> انتقال مالکیت کاملاً خودکار است و نیازی به تایید اپراتور ندارد. اگر گیرنده حساب ندارد، خودکار ایجاد می‌شود.</div>

<h3>۱۰.۶ نکات مهم برای اپراتور</h3>
<table>
  <thead><tr><th>موقعیت</th><th>نکته</th></tr></thead>
  <tbody>
    <tr><td>فروش POS</td><td>کد ثبت مالکیت خودکار — نماینده باید به خریدار اعلام کند</td></tr>
    <tr><td>سفارش هدیه</td><td>فاکتور قیمت داخل بسته قرار ندهید</td></tr>
    <tr><td>«نمی‌توانم ثبت کنم»</td><td>سریال‌کد و claim_code را بررسی کنید</td></tr>
    <tr><td>«انتقال نمی‌شود»</td><td>شمش باید SOLD + customer_id داشته باشد</td></tr>
    <tr><td>«کد گم شده»</td><td>سریال را در شمش‌ها جستجو کنید — claim_code قابل مشاهده</td></tr>
  </tbody>
</table>

<hr>

<!-- ==================== Section 11 ==================== -->
<h2 id="sec11">۱۱. عیب‌یابی (Troubleshooting)</h2>

<h3>خطای CSRF بعد از مدت طولانی بی‌کاری</h3>
<p><strong>علامت:</strong> پس از باز ماندن طولانی صفحه، هنگام ثبت فرم خطا می‌دهد.</p>
<p><strong>راه‌حل:</strong> صفحه را رفرش کنید (Ctrl+F5) و دوباره امتحان کنید.</p>

<h3>قیمت محصول صفر نمایش می‌دهد</h3>
<p><strong>راه‌حل:</strong> ۱) قیمت طلا در تنظیمات بررسی شود ۲) وزن/عیار محصول صفر نباشد</p>

<h3>مشتری نمی‌تواند خرید کند (ناموجود)</h3>
<p><strong>راه‌حل:</strong> شمش با وضعیت «تخصیص» (Assigned) برای آن محصول وجود ندارد → شمش‌ها را تخصیص دهید</p>

<h3>نماینده نمی‌تواند وارد شود</h3>
<p><strong>راه‌حل:</strong> ۱) حساب غیرفعال شده ۲) شماره موبایل اشتباه → بررسی و فعال‌سازی</p>

<h3>کوپن کار نمی‌کند</h3>
<p><strong>بررسی‌ها:</strong> فعال بودن، تاریخ انقضا، سقف استفاده، حداقل سفارش، اولین خرید، خصوصی بودن، محدودیت دسته‌بندی</p>

<h3>درخواست بازخرید ثبت نمی‌شود</h3>
<p><strong>راه‌حل:</strong> سریال‌کد اشتباه یا شمش وضعیت SOLD ندارد</p>

<h3>ثبت مالکیت ناموفق (Claim)</h3>
<p><strong>راه‌حل:</strong> سریال/کد اشتباه، شمش قبلاً ثبت شده، یا claim_code ندارد</p>

<h3>انتقال مالکیت ناموفق</h3>
<p><strong>راه‌حل:</strong> شمش به نام مشتری نیست، OTP منقضی شده، یا شماره گیرنده اشتباه</p>

<hr>

<!-- ==================== Section 12 ==================== -->
<h2 id="sec12">۱۲. واژه‌نامه</h2>

<table>
  <thead><tr><th>اصطلاح</th><th>توضیح</th></tr></thead>
  <tbody>
    <tr><td><strong>شمش (Bar)</strong></td><td>قطعه فیزیکی طلا با سریال‌کد یکتا</td></tr>
    <tr><td><strong>سریال‌کد</strong></td><td>کد ۸ کاراکتری یکتای هر شمش</td></tr>
    <tr><td><strong>عیار (Purity)</strong></td><td>خلوص طلا — ۷۵۰ = ۱۸ عیار</td></tr>
    <tr><td><strong>اجرت (Wage)</strong></td><td>هزینه ساخت و طراحی شمش</td></tr>
    <tr><td><strong>بچ (Batch)</strong></td><td>گروه شمش‌هایی که در یک ذوب تولید شده‌اند</td></tr>
    <tr><td><strong>POS</strong></td><td>فروش حضوری (Point of Sale) توسط نماینده</td></tr>
    <tr><td><strong>بازخرید (Buyback)</strong></td><td>خرید شمش از مشتری توسط نماینده</td></tr>
    <tr><td><strong>کشبک (Cashback)</strong></td><td>مبلغ واریزشده به کیف پول پس از تحویل</td></tr>
    <tr><td><strong>OTP</strong></td><td>رمز یک‌بارمصرف ارسالی از طریق SMS</td></tr>
    <tr><td><strong>ریال / تومان</strong></td><td>مبالغ در سیستم ریال، در نمایش تومان (÷۱۰)</td></tr>
    <tr><td><strong>CSRF</strong></td><td>مکانیزم امنیتی جلوگیری از درخواست‌های جعلی</td></tr>
    <tr><td><strong>Sandbox</strong></td><td>محیط تست درگاه پرداخت</td></tr>
    <tr><td><strong>لجر (Ledger)</strong></td><td>دفتر حسابداری — هر تغییر موجودی ثبت می‌شود</td></tr>
    <tr><td><strong>شبا (IBAN)</strong></td><td>شماره حساب بانکی بین‌المللی</td></tr>
    <tr><td><strong>تیکت (Ticket)</strong></td><td>درخواست پشتیبانی از مشتری یا نماینده</td></tr>
    <tr><td><strong>دپارتمان تیکت</strong></td><td>دسته‌بندی تیکت: مالی/فنی/فروش/شکایات/سایر</td></tr>
    <tr><td><strong>یادداشت داخلی</strong></td><td>یادداشت فقط قابل‌مشاهده توسط کارکنان</td></tr>
    <tr><td><strong>پیوست (Attachment)</strong></td><td>فایل تصویری ضمیمه پیام تیکت</td></tr>
    <tr><td><strong>کلید API</strong></td><td>کلید ۶۴ کاراکتری برای دستگاه POS</td></tr>
    <tr><td><strong>اعتبار فروشگاهی</strong></td><td>مبلغ غیرقابل برداشت — فقط برای خرید</td></tr>
    <tr><td><strong>بازگشت اجرت</strong></td><td>بازگشت اجرت ساخت هنگام بازخرید → اعتبار فروشگاهی</td></tr>
    <tr><td><strong>کد ثبت مالکیت</strong></td><td>کد ۶ کاراکتری یکتا برای ثبت مالکیت</td></tr>
    <tr><td><strong>خرید هدیه</strong></td><td>سفارش بدون ثبت مالکیت + تولید claim code</td></tr>
    <tr><td><strong>انتقال مالکیت</strong></td><td>مالک شمش آن را به شخص دیگری منتقل می‌کند</td></tr>
  </tbody>
</table>

<div class="footer">
  <p>راهنمای اپراتور سیستم طلاملا v4 — فازهای ۱-۱۴ + صفحات ثابت + ثبت مالکیت و انتقال شمش</p>
  <p>تاریخ تولید: بهمن ۱۴۰۴</p>
</div>

</body>
</html>