# راهنمای اپراتور سیستم طلامالا v4

> این سند برای اپراتورهای غیرفنی نوشته شده و تمام عملیات روزانه را قدم‌به‌قدم توضیح می‌دهد.
> پیش‌نیاز: داشتن حساب اپراتور (نقش operator یا super_admin).

---

## فهرست مطالب

1. [شروع سریع](#1-شروع-سریع)
2. [سناریو ۱: مدیریت انبار و شمش‌ها](#2-سناریو-۱-مدیریت-انبار-و-شمشها)
3. [سناریو ۲: فرآیند فروش و سفارشات](#3-سناریو-۲-فرآیند-فروش-و-سفارشات)
4. [سناریو ۳: مدیریت نمایندگان](#4-سناریو-۳-مدیریت-نمایندگان)
5. [سناریو ۴: مدیریت کوپن‌ها](#5-سناریو-۴-مدیریت-کوپنها)
6. [سناریو ۵: احراز اصالت و کیف پول](#6-سناریو-۵-احراز-اصالت-و-کیف-پول)
7. [سناریو ۶: مدیریت تیکت‌های پشتیبانی](#7-سناریو-۶-مدیریت-تیکتهای-پشتیبانی)
8. [سناریو ۷: مدیریت کلید API دستگاه POS](#8-سناریو-۷-مدیریت-کلید-api-دستگاه-pos)
9. [سناریو ۸: صفحات ثابت و فوتر](#9-سناریو-۸-صفحات-ثابت-و-فوتر)
10. [سناریو ۹: ثبت مالکیت، خرید هدیه و انتقال شمش](#10-سناریو-۹-ثبت-مالکیت-خرید-هدیه-و-انتقال-شمش)
11. [عیب‌یابی (Troubleshooting)](#11-عیبیابی)
12. [واژه‌نامه](#12-واژهنامه)

---

## 1. شروع سریع

### نحوه ورود به پنل مدیریت

1. مرورگر را باز کنید و به آدرس سایت بروید (مثلاً `http://127.0.0.1:8000`)
2. روی «ورود» کلیک کنید یا مستقیم به `/auth/login` بروید
3. شماره موبایل اپراتور خود را وارد کنید
4. کد OTP دریافتی از SMS را وارد کنید
5. سیستم شما را به **داشبورد مدیریت** هدایت می‌کند

### آشنایی با داشبورد

پس از ورود، داشبورد شامل موارد زیر است:

- **کارت‌های آماری بالا**: درآمد کل، تعداد سفارشات، تعداد مشتریان، تعداد شمش‌ها
- **کارت‌های آماری دوم**: سفارش امروز، درآمد امروز، در انتظار پرداخت، شمش موجود، نماینده فعال، درخواست برداشت
- **نمودار درآمد**: نمودار خطی درآمد ۳۰ روز اخیر
- **نمودار موجودی**: نمودار دایره‌ای وضعیت شمش‌ها
- **آخرین سفارشات**: جدول ۱۰ سفارش اخیر
- **دسترسی سریع**: لینک به بخش‌های مختلف
- **قیمت طلا**: قیمت فعلی طلای ۱۸ عیار
- **هشدارها**: تعداد موارد در انتظار بررسی

### منوی کناری (Sidebar)

| آیکون | بخش | توضیح |
|--------|------|--------|
| داشبورد | `/admin/dashboard` | صفحه اصلی مدیریت |
| محصولات | `/admin/products` | مدیریت محصولات (شمش‌ها) |
| دسته‌بندی | `/admin/categories` | دسته‌بندی محصولات |
| طرح کارت | `/admin/designs` | طرح‌های کارت هدیه |
| بسته‌بندی | `/admin/packages` | انواع بسته‌بندی |
| بچ‌ها | `/admin/batches` | بچ‌های تولید |
| شمش‌ها | `/admin/bars` | انبارداری شمش |
| مکان‌ها | `/admin/locations` | مکان‌های فیزیکی |
| سفارشات | `/admin/orders` | مدیریت سفارشات |
| کیف پول | `/admin/wallet/accounts` | حساب‌های کیف پول |
| برداشت‌ها | `/admin/wallet/withdrawals` | درخواست‌های برداشت |
| کوپن‌ها | `/admin/coupons` | مدیریت کوپن تخفیف |
| نمایندگان | `/admin/dealers` | مدیریت نمایندگان |
| بازخرید | `/admin/dealers/buybacks` | درخواست‌های بازخرید |
| تیکت‌ها | `/admin/tickets` | تیکت‌های پشتیبانی |
| تنظیمات | `/admin/settings` | تنظیمات سیستم (فقط مدیرکل) |

---

## 2. سناریو ۱: مدیریت انبار و شمش‌ها

### ۲.۱ ایجاد مکان جدید

**کی لازم است؟** وقتی شعبه یا انبار جدیدی راه‌اندازی می‌شود.

1. از منو **مکان‌ها** را انتخاب کنید
2. روی **«ایجاد مکان جدید»** کلیک کنید
3. فرم را پر کنید:
   - **نام**: مثلاً «نمایندگی اصفهان»
   - **نوع**: یکی از: کارخانه، انبار مرکزی، نمایندگی، پلتفرم آنلاین
   - **استان و شهر**: محل فیزیکی
   - **آدرس**: آدرس کامل
   - **تلفن**: شماره تماس
   - **هاب پستی**: اگر از این مکان ارسال پستی انجام می‌شود، تیک بزنید
4. دکمه **«ذخیره»** را بزنید

### ۲.۲ ایجاد و ویرایش محصول

**کی لازم است؟** وقتی محصول جدیدی (نوع شمش) به سیستم اضافه می‌شود یا مشخصات محصول موجود تغییر می‌کند.

1. از منو **محصولات** را انتخاب کنید
2. برای ایجاد: روی **«ایجاد محصول جدید»** کلیک کنید
3. برای ویرایش: روی **«ویرایش»** کنار محصول کلیک کنید
4. فرم را پر کنید:
   - **نام**: نام محصول (مثلاً «شمش ۱ گرمی ۱۸ عیار»)
   - **دسته‌بندی‌ها**: با **چک‌باکس** یک یا چند دسته‌بندی انتخاب کنید — هر محصول می‌تواند در **چند دسته‌بندی** قرار بگیرد (مثلاً هم «شمش گرمی» و هم «شمش سرمایه‌ای»)
   - **وزن**: وزن شمش (گرم)
   - **عیار**: خلوص طلا (۷۵۰ = ۱۸ عیار)
   - **اجرت ساخت**: درصدی یا مبلغ ثابت
   - سایر فیلدها: سود، کمیسیون، هزینه سنگ، لوازم جانبی
5. **«ذخیره»** را بزنید

**نکته مهم درباره دسته‌بندی‌ها**: حداقل یک دسته‌بندی باید انتخاب شود. محصولاتی که در چند دسته‌بندی هستند، هنگام فیلتر بر اساس هر یک از دسته‌بندی‌هایشان در فروشگاه نمایش داده می‌شوند.

### ۲.۳ ثبت شمش جدید

**کی لازم است؟** وقتی شمش‌های جدید از کارخانه دریافت می‌شوند.

**توجه**: شمش‌ها معمولاً از طریق `seed.py` یا ایمپورت دسته‌ای وارد سیستم می‌شوند. مدیریت تکی شمش‌ها از طریق صفحه ویرایش انجام می‌شود.

### ۲.۴ مشاهده و فیلتر شمش‌ها

1. از منو **شمش‌ها** را انتخاب کنید
2. فیلترهای موجود:
   - **وضعیت**: خام (Raw)، تخصیص (Assigned)، رزرو (Reserved)، فروخته (Sold)
   - **جستجو**: بر اساس سریال‌کد
3. هر ردیف نمایش می‌دهد: سریال‌کد، محصول، وضعیت، مکان، مشتری

### ۲.۵ ویرایش شمش

1. در لیست شمش‌ها روی **«ویرایش»** کلیک کنید
2. می‌توانید تغییر دهید:
   - **محصول تخصیص‌یافته**: کدام محصول به این شمش وصل است
   - **مکان**: شمش در کدام انبار/شعبه است
   - **بچ تولید**: متعلق به کدام ذوب
   - **طرح کارت**: طرح بسته‌بندی
   - **نوع بسته‌بندی**: نوع جعبه
3. **ذخیره** کنید

### ۲.۶ چرخه حیات شمش

```
  خام (Raw)
    │
    ▼  ← تخصیص محصول
  تخصیص (Assigned)  ← آماده فروش
    │
    ▼  ← مشتری به سبد اضافه می‌کند
  رزرو (Reserved)   ← در سبد خرید
    │
    ├── ▼ پرداخت موفق
    │  فروخته (Sold)  ← مالکیت مشتری
    │
    └── ▼ لغو / تایم‌اوت
       تخصیص (Assigned)  ← برگشت به فروش
```

---

## 3. سناریو ۲: فرآیند فروش و سفارشات

### ۳.۱ جریان خرید مشتری (آنلاین)

مشتری این مراحل را طی می‌کند:

1. ورود به فروشگاه → مشاهده محصولات
2. افزودن محصول به سبد خرید
3. صفحه چک‌اوت:
   - انتخاب روش تحویل (حضوری / پستی)
   - وارد کردن کوپن تخفیف (اختیاری)
4. پرداخت (کیف پول یا درگاه بانکی)
5. دریافت سفارش

### ۳.۲ مدیریت سفارشات (اپراتور)

1. از منو **سفارشات** را انتخاب کنید
2. فیلتر بر اساس وضعیت:
   - **همه**: تمام سفارشات
   - **در انتظار**: هنوز پرداخت نشده
   - **پرداخت شده**: آماده ارسال
   - **ارسال شده**: در حال ارسال
   - **تحویل شده**: تکمیل
   - **لغو شده**: لغو شده
3. هر ردیف نمایش می‌دهد:
   - شماره سفارش، نام مشتری، مبلغ، وضعیت، روش تحویل، تاریخ

### ۳.۳ تغییر وضعیت سفارش

**پس از پرداخت و آماده‌سازی شمش:**

1. سفارش را پیدا کنید (وضعیت: پرداخت شده)
2. شمش‌ها را آماده و بسته‌بندی کنید
3. وضعیت ارسال را به‌روزرسانی کنید:
   - **حضوری**: هماهنگی با نمایندگی برای تحویل
   - **پستی**: ثبت کد پیگیری پستی

### ۳.۴ استرداد سفارش

**توجه**: استرداد فقط توسط ادمین قابل انجام است.

1. سفارش مورد نظر را باز کنید
2. دکمه **«استرداد»** را بزنید
3. مبلغ به کیف پول مشتری برگشت داده می‌شود
4. شمش‌ها آزاد شده و به وضعیت قبلی برمی‌گردند

---

## 4. سناریو ۳: مدیریت نمایندگان

### ۴.۱ ایجاد نماینده جدید

1. از منو **نمایندگان** را انتخاب کنید
2. روی **«ایجاد نماینده جدید»** کلیک کنید
3. فرم را پر کنید:
   - **شماره موبایل**: شماره ۱۱ رقمی (09xxxxxxxxx) — نماینده با این شماره لاگین می‌کند
   - **نام کامل**: نام و نام خانوادگی
   - **کد ملی**: اختیاری (۱۰ رقمی)
   - **محل نمایندگی**: انتخاب از لیست مکان‌های نوع «نمایندگی» (Branch)
   - **درصد کمیسیون**: پیش‌فرض ۲٪ — درصدی از هر فروش حضوری که به نماینده تعلق می‌گیرد
4. **«ایجاد نماینده»** را بزنید

### ۴.۲ ویرایش نماینده

1. در لیست نمایندگان روی **«ویرایش»** کلیک کنید
2. قابل تغییر:
   - نام کامل
   - محل نمایندگی
   - درصد کمیسیون
   - وضعیت فعال/غیرفعال
3. **«ذخیره تغییرات»** را بزنید

**نکته**: غیرفعال کردن نماینده مانع از ورود او به پنل نمایندگی می‌شود.

### ۴.۳ بررسی درخواست‌های بازخرید

**بازخرید چیست؟** وقتی مشتری می‌خواهد شمشی را که قبلاً خریده به فروشنده برگرداند و پول خود را دریافت کند. نماینده درخواست بازخرید ثبت می‌کند و ادمین تایید/رد می‌کند.

1. از منو **بازخرید نمایندگان** را انتخاب کنید
2. فیلتر بر اساس وضعیت:
   - **همه**: تمام درخواست‌ها
   - **در انتظار**: نیاز به بررسی
   - **تایید شده**: تایید شده و آماده تسویه
   - **رد شده**: رد شده
3. برای هر درخواست «در انتظار» دو دکمه وجود دارد:
   - **تایید**: سیستم یادداشت اختیاری می‌خواهد → تایید درخواست
   - **رد**: سیستم دلیل رد را می‌خواهد → رد درخواست

### ۴.۴ تایید بازخرید با بازگشت اجرت (Buyback Wage Refund)

**چه زمانی اتفاق می‌افتد؟** وقتی نماینده درخواست بازخرید شمشی را ثبت می‌کند که قبلاً به یک مشتری ثبت‌نام‌شده فروخته شده است.

**مراحل:**

1. از منو **بازخرید نمایندگان** (`/admin/dealers/buybacks`) را انتخاب کنید
2. درخواست بازخرید «در انتظار» مورد نظر را پیدا کنید
3. دکمه **«تایید»** را بزنید
4. در صورت نیاز یادداشت ادمین وارد کنید (اختیاری)
5. سیستم به‌صورت خودکار اقدامات زیر را انجام می‌دهد:
   - وضعیت شمش از **فروخته (SOLD)** به **تخصیص (ASSIGNED)** تغییر می‌کند
   - مالکیت شمش حذف می‌شود (customer_id → null)
   - یک رکورد **OwnershipHistory** ثبت می‌شود
   - اجرت اصلی که هنگام فروش شمش پرداخت شده بود (از `OrderItem.final_wage_amount`) جستجو می‌شود
   - در صورت یافتن: مبلغ اجرت به‌عنوان **اعتبار فروشگاهی غیرقابل برداشت** به کیف پول مشتری واریز می‌شود
   - پیام موفقیت با مبلغ اعتبار واریزشده نمایش داده می‌شود

**آنچه اپراتور می‌بیند:**
- پیام موفقیت: **«بازخرید #X تایید شد — اعتبار اجرت Y تومان به کیف پول مشتری واریز شد»**
- در جدول بازخریدها، ستون **«اعتبار اجرت»** مبلغ واریزشده را نشان می‌دهد

**حالات خاص:**
- اگر شمش از طریق POS فروخته شده باشد (بدون OrderItem): بازگشت اجرت انجام نمی‌شود. تایید بازخرید بدون مشکل ادامه می‌یابد.
- اگر شمش فاقد customer_id باشد: بازگشت اجرت انجام نمی‌شود.

**تایید اعتبار واریزشده:**
1. به **کیف پول** → **حساب‌ها** (`/admin/wallets`) بروید
2. مشتری مربوطه را پیدا کنید و وارد جزئیات کیف پول شوید
3. در خلاصه موجودی، مبلغ **«اعتبار فروشگاهی»** قابل مشاهده است
4. در لیست تراکنش‌ها، یک رکورد CREDIT با توضیحات **«اعتبار بازگشت اجرت بازخرید شمش {سریال}»** وجود دارد

**مشتری چه می‌بیند؟**
- اعتبار فروشگاهی در صفحه کیف پول تحت عنوان **«اعتبار فروشگاهی»** نمایش داده می‌شود
- این اعتبار برای خرید قابل استفاده است اما **قابل برداشت نیست**
- در فرم برداشت، موجودی «قابل برداشت» نمایش داده می‌شود (بدون احتساب اعتبار فروشگاهی)

### ۴.۵ مشاهده آمار نمایندگان

در صفحه لیست نمایندگان، ۶ کارت آماری بالای صفحه نمایش داده می‌شود:
- تعداد کل نمایندگان
- نمایندگان فعال
- کل فروش حضوری
- درآمد فروش حضوری
- کل کمیسیون پرداختی
- درخواست‌های بازخرید در انتظار

---

## 5. سناریو ۴: مدیریت کوپن‌ها

### ۵.۱ ایجاد کوپن تخفیف

1. از منو **کوپن‌ها** را انتخاب کنید
2. روی **«ایجاد کوپن جدید»** کلیک کنید
3. فیلدهای اصلی:
   - **کد کوپن**: کدی که مشتری وارد می‌کند (مثلاً WELCOME10)
   - **عنوان**: نام نمایشی
   - **نوع**: تخفیف (DISCOUNT) یا کشبک (CASHBACK)
   - **حالت تخفیف**: درصدی (PERCENT) یا مبلغ ثابت (FIXED)
   - **مقدار تخفیف**: عدد درصد یا مبلغ (تومان)
4. محدودیت‌ها (اختیاری):
   - **سقف تخفیف**: حداکثر مبلغ تخفیف (برای حالت درصدی)
   - **حداقل سفارش**: حداقل مبلغ سفارش برای استفاده از کوپن
   - **حداکثر سفارش**: سقف مبلغ سفارش
   - **سقف استفاده کل**: چند بار در کل قابل استفاده است
   - **سقف هر مشتری**: هر مشتری چند بار می‌تواند استفاده کند
   - **تاریخ شروع / انقضا**: بازه زمانی اعتبار
5. تنظیمات خاص:
   - **فقط اولین خرید**: فقط مشتریانی که خرید قبلی ندارند
   - **خصوصی**: فقط با وارد کردن کد (نه در لیست عمومی)
6. **«ایجاد کوپن»** را بزنید

### ۵.۲ تفاوت تخفیف و کشبک

| ویژگی | تخفیف (DISCOUNT) | کشبک (CASHBACK) |
|--------|-------------------|-----------------|
| زمان اعمال | هنگام خرید | پس از تحویل |
| نحوه اعمال | کسر از مبلغ سفارش | واریز به کیف پول |
| مشتری می‌بیند | قیمت کمتر در چک‌اوت | مبلغ واریزشده در کیف پول |

### ۵.۳ مثال‌های کاربردی

**مثال ۱ — کوپن خوش‌آمدگویی:**
- کد: `WELCOME10`
- نوع: تخفیف درصدی ۱۰٪
- سقف تخفیف: ۲,۰۰۰,۰۰۰ تومان
- فقط اولین خرید: بله

**مثال ۲ — کشبک مناسبتی:**
- کد: `CASHBACK5`
- نوع: کشبک درصدی ۵٪
- بدون سقف
- سقف استفاده کل: ۱۰۰ بار

**مثال ۳ — تخفیف مبلغ ثابت:**
- کد: `FIXED500`
- نوع: تخفیف مبلغ ثابت ۵۰۰,۰۰۰ تومان
- حداقل سفارش: ۵,۰۰۰,۰۰۰ تومان

**مثال ۴ — کوپن VIP (لیست سفید موبایل):**
- کد: `VIP2026`
- نوع: تخفیف درصدی ۱۵٪
- خصوصی: بله
- موبایل‌های مجاز: فقط شماره‌های اضافه‌شده در بخش «لیست سفید»

### ۵.۴ محدودیت دسته‌بندی (کوپن تخصصی دسته)

**کی لازم است؟** وقتی می‌خواهید کوپن فقط برای دسته‌بندی‌های خاصی معتبر باشد (مثلاً فقط شمش گرمی، یا فقط شمش ۱۰ مثقالی).

1. در فرم ایجاد/ویرایش کوپن، در قسمت **«محدودیت‌ها»**:
   - فیلد **«محدوده کوپن»** را پیدا کنید
   - **«دسته‌بندی»** (CATEGORY) را انتخاب کنید
2. لیست تمام دسته‌بندی‌های محصول با چک‌باکس نمایش داده می‌شود
3. دسته‌بندی‌هایی که می‌خواهید کوپن برای آن‌ها معتبر باشد را **تیک** بزنید
4. **«ایجاد کوپن»** یا **«ذخیره تغییرات»** را بزنید

**نحوه عملکرد**:
- اگر سبد خرید مشتری **حداقل یک محصول** از دسته‌بندی‌های انتخاب‌شده داشته باشد → کوپن معتبر است
- اگر سبد خرید **هیچ محصولی** از دسته‌بندی‌های انتخاب‌شده نداشته باشد → سیستم پیام می‌دهد: «این کد فقط برای دسته‌بندی خاصی معتبر است»
- اگر هیچ دسته‌بندی انتخاب نشود → کوپن برای **تمام دسته‌بندی‌ها** معتبر است

**مثال عملی — کوپن GOLD10:**
- کد: `GOLD10`
- نوع: تخفیف درصدی ۱۰٪
- محدوده: دسته‌بندی
- دسته‌بندی‌های انتخاب‌شده: فقط **«شمش گرمی»**
- نتیجه: مشتری فقط اگر شمش گرمی در سبد داشته باشد می‌تواند از این کوپن استفاده کند

### ۵.۵ غیرفعال کردن کوپن

1. کوپن مورد نظر را باز کنید
2. وضعیت را به **«غیرفعال»** تغییر دهید
3. ذخیره کنید

---

## 6. سناریو ۵: احراز اصالت و کیف پول

### ۶.۱ احراز اصالت شمش

**صفحه عمومی** — هر کسی می‌تواند اصالت شمش را بررسی کند:

1. به آدرس `/verify` بروید
2. سریال‌کد ۸ کاراکتری شمش را وارد کنید
3. سیستم نمایش می‌دهد:
   - **شمش اصل**: نام محصول، وزن، عیار، وضعیت فعلی
   - **شمش نامعتبر**: پیام «سریال‌کد یافت نشد»

### ۶.۲ مدیریت حساب‌های کیف پول

1. از منو **کیف پول** → **حساب‌ها** را انتخاب کنید
2. لیست تمام حساب‌های مشتریان نمایش داده می‌شود:
   - نام مشتری، موجودی، مبلغ بلوکه‌شده
3. روی هر حساب کلیک کنید تا جزئیات و تاریخچه تراکنش‌ها را ببینید

### ۶.۳ بررسی درخواست‌های برداشت

**برداشت چیست؟** مشتری می‌خواهد مبلغی از کیف پول خود به حساب بانکی واریز شود.

1. از منو **کیف پول** → **برداشت‌ها** را انتخاب کنید
2. درخواست‌های «در انتظار» را بررسی کنید:
   - نام مشتری، مبلغ درخواستی، شماره شبا، نام صاحب حساب
3. اقدام:
   - **تایید**: مبلغ را به حساب بانکی مشتری واریز کنید، سپس دکمه «تایید» را بزنید
   - **رد**: در صورت مشکل (شبا نامعتبر، مغایرت نام) دکمه «رد» را بزنید

**مهم**: تایید درخواست برداشت فقط به معنای تایید در سیستم است. واریز واقعی به حساب بانکی باید **دستی** توسط حسابدار انجام شود.

### ۶.۴ تنظیمات سیستم (فقط مدیرکل)

**توجه**: فقط کاربران با نقش `super_admin` به تنظیمات دسترسی دارند.

1. از منو **تنظیمات** را انتخاب کنید
2. تنظیمات قابل تغییر:
   - **قیمت طلای ۱۸ عیار**: قیمت هر گرم طلای ۱۸ عیار به ریال — این عدد مبنای محاسبه قیمت تمام محصولات است
   - **درصد مالیات**: درصد مالیات بر ارزش افزوده
   - **هزینه ارسال**: هزینه پایه ارسال پستی
   - **بیمه ارسال**: هزینه بیمه مرسوله
3. **«ذخیره»** را بزنید

**هشدار**: تغییر قیمت طلا فوراً روی قیمت تمام محصولات در فروشگاه اثر می‌گذارد.

---

## 7. سناریو ۶: مدیریت تیکت‌های پشتیبانی

### ۷.۱ آشنایی با سیستم تیکت

مشتریان و نمایندگان می‌توانند از طریق سیستم تیکت، سوالات و مشکلات خود را مطرح کنند. اپراتور تیکت‌ها را بررسی و پاسخ می‌دهد.

**نکته کلیدی**: تیکت‌های مشتریان و نمایندگان با **تب‌های جداگانه** و **badge رنگی** مشخص می‌شوند تا اپراتور به سادگی تشخیص دهد هر تیکت از کجا آمده.

### ۷.۲ مشاهده لیست تیکت‌ها

1. از منو **تیکت‌های پشتیبانی** را انتخاب کنید (`/admin/tickets`)
2. بالای صفحه **تب‌ها** نمایش داده می‌شود:
   - **همه**: تمام تیکت‌ها (با badge تعداد کل)
   - **مشتریان**: فقط تیکت‌های مشتریان (badge آبی)
   - **نمایندگان**: فقط تیکت‌های نمایندگان (badge بنفش)
3. **دکمه‌های فیلتر وضعیت**:
   - باز | در حال بررسی | پاسخ داده شده | بسته
4. جدول نمایش می‌دهد:
   - نوع فرستنده (مشتری / نماینده) با badge رنگی
   - موضوع تیکت
   - اولویت (کم / متوسط / بالا)
   - وضعیت
   - اپراتور تخصیص‌یافته
   - تعداد پیام‌ها
   - تاریخ ایجاد

### ۷.۳ پاسخ دادن به تیکت

1. روی تیکت مورد نظر کلیک کنید
2. **بخش مکالمه** (سمت چپ):
   - پیام اولیه فرستنده
   - تمام پاسخ‌ها به ترتیب زمانی
   - پیام‌های اپراتور با **پس‌زمینه سبز** مشخص می‌شوند
3. در فرم پاسخ، متن خود را بنویسید و **«ارسال پاسخ»** را بزنید
4. وضعیت تیکت به‌صورت خودکار به **«پاسخ داده شده»** تغییر می‌کند
5. اگر تیکت هنوز تخصیص نشده، **خودکار** به شما تخصیص داده می‌شود

### ۷.۴ تخصیص تیکت به اپراتور

1. صفحه جزئیات تیکت را باز کنید
2. در **پنل کناری** (سمت راست):
   - قسمت **«تخصیص»** را پیدا کنید
   - از لیست کشویی اپراتور مورد نظر را انتخاب کنید
   - **«تخصیص»** را بزنید
3. اگر تیکت «باز» باشد، وضعیت خودکار به **«در حال بررسی»** تغییر می‌کند

### ۷.۵ تغییر وضعیت تیکت

1. در پنل کناری جزئیات تیکت:
   - از لیست کشویی **«تغییر وضعیت»** وضعیت جدید را انتخاب کنید
   - **«اعمال»** را بزنید
2. وضعیت‌های ممکن: باز، در حال بررسی، پاسخ داده شده، بسته

### ۷.۶ بستن تیکت

1. در پنل کناری دکمه **«بستن تیکت»** (قرمز) را بزنید
2. تیکت بسته شده و دیگر امکان پاسخ دادن وجود ندارد

**نکته**: مشتری یا نماینده هم می‌توانند تیکت خود را ببندند.

### ۷.۷ رفتار خودکار وضعیت

| اقدام | تغییر وضعیت خودکار |
|--------|---------------------|
| اپراتور پاسخ می‌دهد | → پاسخ داده شده (Answered) |
| مشتری/نماینده پاسخ می‌دهد (وقتی وضعیت Answered است) | → باز (Open) — تیکت بازگشایی می‌شود |
| تخصیص به اپراتور (وقتی باز است) | → در حال بررسی (InProgress) |
| اولین پاسخ اپراتور (بدون تخصیص) | → تخصیص خودکار به اپراتور پاسخ‌دهنده |

### ۷.۸ پیوست فایل در تیکت

**کی لازم است؟** وقتی مشتری یا نماینده می‌خواهد اسکرین‌شات، رسید پرداخت، یا تصویری را به تیکت ضمیمه کند. اپراتور هم می‌تواند هنگام پاسخ‌دهی فایل پیوست کند.

**فرمت‌های مجاز:** JPG، PNG، WEBP — **حداکثر حجم: ۱۰ مگابایت** برای هر فایل.

**ارسال فایل توسط مشتری/نماینده:**

1. مشتری یا نماینده تیکت جدید ایجاد می‌کند یا به تیکت موجود پاسخ می‌دهد
2. در فرم ارسال، فیلد **«پیوست فایل»** وجود دارد
3. فایل تصویری را انتخاب می‌کند (JPG/PNG/WEBP تا ۱۰MB)
4. پس از ارسال، تصویر در کنار متن پیام نمایش داده می‌شود

**ارسال فایل توسط اپراتور:**

1. صفحه جزئیات تیکت را باز کنید
2. در فرم پاسخ، متن پاسخ را بنویسید
3. در صورت نیاز از فیلد **«پیوست فایل»** یک تصویر انتخاب کنید
4. **«ارسال پاسخ»** را بزنید — متن و تصویر همراه هم ارسال می‌شوند

**نکات مهم:**
- اگر حجم فایل بیشتر از ۱۰ مگابایت باشد، سیستم پیام خطا نمایش می‌دهد
- اگر فرمت فایل غیرمجاز باشد (مثلاً PDF یا ZIP)، آپلود انجام نمی‌شود
- تصاویر پیوست‌شده در بخش مکالمه تیکت به‌صورت thumbnail قابل مشاهده هستند

### ۷.۹ دسته‌بندی / دپارتمان تیکت

**کی لازم است؟** برای دسته‌بندی تیکت‌ها بر اساس نوع درخواست و هدایت آن‌ها به دپارتمان مناسب.

**دپارتمان‌های موجود:**
| دپارتمان | توضیح |
|-----------|--------|
| مالی | سوالات مربوط به پرداخت، کیف پول، استرداد |
| فنی | مشکلات فنی سایت، اپلیکیشن، دستگاه POS |
| فروش | سوالات قبل از خرید، مشاوره محصول |
| شکایات | شکایت از خدمات، محصول، نماینده |
| سایر | موارد متفرقه |

**هنگام ایجاد تیکت (مشتری/نماینده):**

1. در فرم ایجاد تیکت، فیلد **«دپارتمان»** را انتخاب کنید
2. دپارتمان مناسب را از لیست کشویی انتخاب کنید (مالی / فنی / فروش / شکایات / سایر)
3. تیکت ثبت شده با دپارتمان مشخص‌شده نمایش داده می‌شود

**فیلتر بر اساس دپارتمان (اپراتور):**

1. در صفحه لیست تیکت‌ها (`/admin/tickets`)
2. علاوه بر تب‌ها (همه/مشتریان/نمایندگان) و فیلتر وضعیت، **فیلتر دپارتمان** نیز وجود دارد
3. دپارتمان مورد نظر را انتخاب کنید تا فقط تیکت‌های آن دپارتمان نمایش داده شوند
4. فیلتر دپارتمان با سایر فیلترها (وضعیت، نوع فرستنده) ترکیب می‌شود

**مزیت:** اپراتورهایی که مسئول یک دپارتمان خاص هستند می‌توانند فقط تیکت‌های مرتبط با حوزه خود را ببینند.

### ۷.۱۰ یادداشت داخلی (Internal Notes)

**کی لازم است؟** وقتی اپراتور نیاز دارد نکته‌ای را برای سایر اپراتورها ثبت کند بدون اینکه مشتری یا نماینده آن را ببیند.

**ایجاد یادداشت داخلی:**

1. صفحه جزئیات تیکت را باز کنید
2. در فرم پاسخ، علاوه بر دکمه **«ارسال پاسخ»**، دکمه‌ای با عنوان **«یادداشت داخلی»** وجود دارد
3. متن یادداشت خود را بنویسید
4. **«یادداشت داخلی»** را بزنید

**نمایش یادداشت‌ها:**
- یادداشت‌های داخلی با **آیکون قفل/هشدار** و **پس‌زمینه متفاوت** (زرد/نارنجی) از پاسخ‌های عادی مشخص می‌شوند
- برچسب **«یادداشت داخلی — فقط قابل مشاهده توسط کارکنان»** در بالای یادداشت نمایش داده می‌شود
- **مشتری و نماینده این یادداشت‌ها را نمی‌بینند** — فقط کارکنان (اپراتور و مدیرکل) دسترسی دارند

**موارد استفاده:**
- «با تیم مالی هماهنگ شد — در انتظار تایید»
- «منتظر تایید مدیر هستیم»
- «مشتری قبلاً هم همین مشکل را داشته — پرونده قبلی #۲۳ مرتبط است»
- «شماره شبا مشتری بررسی شد — مغایرت نام وجود دارد»

### ۷.۱۱ جستجوی تیکت

**کی لازم است؟** وقتی اپراتور به دنبال تیکت خاصی است و نمی‌خواهد تک‌تک صفحات را مرور کند.

**نحوه جستجو:**

1. در صفحه لیست تیکت‌ها (`/admin/tickets`)
2. فیلد **جستجو** در بالای صفحه (کنار فیلترها) وجود دارد
3. عبارت مورد نظر را تایپ کنید و **جستجو** را بزنید

**قابلیت جستجو بر اساس:**
- **شماره تیکت**: مثلاً `۱۲۳` یا `123`
- **موضوع تیکت**: بخشی از متن موضوع (مثلاً «پرداخت» یا «ارسال»)
- **نام مشتری/نماینده**: نام فرستنده تیکت
- **شماره موبایل**: شماره موبایل فرستنده

**نکته مهم:** جستجو با فیلترهای موجود (وضعیت، دپارتمان، نوع فرستنده) ترکیب می‌شود. یعنی اگر تب «مشتریان» فعال باشد و وضعیت «باز» انتخاب شده باشد، جستجو فقط در تیکت‌های باز مشتریان انجام می‌شود.

### ۷.۱۲ اطلاع‌رسانی پیامکی تیکت

**سیستم در موارد زیر پیامک اطلاع‌رسانی ارسال می‌کند:**

| رویداد | گیرنده | متن تقریبی |
|--------|---------|------------|
| اپراتور به تیکت پاسخ می‌دهد | مشتری/نماینده | «پاسخ جدیدی برای تیکت #X ارسال شد» |
| وضعیت تیکت تغییر می‌کند | مشتری/نماینده | «وضعیت تیکت #X به Y تغییر یافت» |

**نکات:**
- اطلاع‌رسانی فقط به **مشتری یا نماینده** فرستنده تیکت ارسال می‌شود (نه به اپراتور)
- شماره موبایل گیرنده از پروفایل مشتری یا اطلاعات نماینده خوانده می‌شود
- در **محیط توسعه** (بدون `SMS_API_KEY`): پیامک واقعی ارسال نمی‌شود و فقط در **کنسول سرور** چاپ می‌شود (لاگ)
- در **محیط تولید** (با `SMS_API_KEY` معتبر): پیامک از طریق سرویس کاوه‌نگار ارسال می‌شود
- اپراتور نیازی به تنظیم خاصی ندارد — اطلاع‌رسانی **خودکار** است

---

## 8. سناریو ۷: مدیریت کلید API دستگاه POS

### ۸.۱ آشنایی

نمایندگان از دستگاه‌های POS اندرویدی برای فروش حضوری شمش استفاده می‌کنند. هر دستگاه با **کلید API** احراز هویت می‌شود که توسط اپراتور تولید و مدیریت می‌شود.

### ۸.۲ تولید کلید API

1. از منو **نمایندگان** را انتخاب کنید (`/admin/dealers`)
2. نماینده مورد نظر را **ویرایش** کنید
3. در بخش **کلید API دستگاه POS** (پایین فرم):
   - روی **«تولید کلید API»** کلیک کنید
4. کلید تولید شده نمایش داده می‌شود
5. با دکمه **کپی** کلید را کپی کرده و در اختیار تیم فنی یا نماینده قرار دهید

**نکته**: هر نماینده فقط یک کلید API فعال دارد. تولید کلید جدید، کلید قبلی را باطل می‌کند.

### ۸.۳ لغو کلید API

1. صفحه ویرایش نماینده را باز کنید
2. در بخش کلید API، روی **«لغو کلید»** کلیک کنید
3. تایید کنید — کلید حذف و دستگاه POS از کار می‌افتد

### ۸.۴ عیب‌یابی دستگاه POS

| مشکل | راه‌حل |
|--------|--------|
| دستگاه خطای «کلید نامعتبر» می‌دهد | کلید API را لغو و مجدد تولید کنید |
| لیست محصولات خالی است | مطمئن شوید شمش‌هایی با وضعیت ASSIGNED در شعبه نماینده وجود دارد |
| فروش ثبت نمی‌شود | سریال شمش را بررسی کنید — شمش باید ASSIGNED و در شعبه نماینده باشد |

---

## 9. سناریو ۸: صفحات ثابت و فوتر

### ۹.۱ آشنایی

سایت فروشگاهی شامل چند صفحه اطلاع‌رسانی ثابت است که بدون نیاز به لاگین قابل‌دسترسی هستند. این صفحات اطلاعات عمومی شرکت، سوالات متداول، راه‌های ارتباطی و قوانین استفاده از سایت را نمایش می‌دهند.

### ۹.۲ صفحات موجود

| صفحه | آدرس | توضیح |
|--------|------|--------|
| درباره ما | `/about` | معرفی شرکت طلامالا، تاریخچه و ماموریت |
| سوالات متداول | `/faq` | سوالات پرتکرار مشتریان با پاسخ |
| تماس با ما | `/contact` | آدرس، تلفن، ایمیل، ساعت کاری |
| قوانین و مقررات | `/terms` | شرایط استفاده از خدمات فروشگاه |

### ۹.۳ به‌روزرسانی محتوای صفحات ثابت

**کی لازم است؟** وقتی اطلاعات شرکت تغییر می‌کند (آدرس جدید، تلفن جدید، تغییر ساعت کاری) یا نیاز به افزودن/ویرایش سوالات متداول وجود دارد.

**نکته مهم**: محتوای صفحات ثابت در فایل‌های قالب (Template) ذخیره شده و از طریق پنل مدیریت قابل‌ویرایش **نیست**. برای تغییر محتوا باید فایل‌های زیر توسط تیم فنی ویرایش شوند:

| صفحه | فایل قالب |
|--------|-----------|
| درباره ما | `templates/shop/about.html` |
| سوالات متداول | `templates/shop/faq.html` |
| تماس با ما | `templates/shop/contact.html` |
| قوانین و مقررات | `templates/shop/terms.html` |

**مراحل درخواست تغییر:**

1. متن جدید یا تغییرات مورد نظر را تهیه کنید
2. درخواست تغییر را به تیم فنی ارسال کنید (یا تیکت داخلی ثبت کنید)
3. تیم فنی فایل قالب مربوطه را ویرایش و deploy می‌کند
4. پس از deploy، تغییرات بلافاصله در سایت اعمال می‌شوند

### ۹.۴ فوتر سایت

فوتر سایت در تمام صفحات فروشگاه نمایش داده می‌شود و شامل:

- **اطلاعات شرکت**: نام، توضیح، آدرس فیزیکی، تلفن، ایمیل
- **لینک‌های سریع**: لینک به صفحات اصلی سایت (فروشگاه، احراز اصالت، سوالات متداول، درباره ما، تماس با ما، قوانین)
- **نشان‌های اعتماد**: لوگوهای اعتماد الکترونیکی (enamad، ساماندهی)
- **شبکه‌های اجتماعی**: لینک به اینستاگرام، تلگرام، واتساپ
- **لینک‌های عضویت**: لینک به انجمن‌های صنفی و مجامع مرتبط

**تغییر اطلاعات فوتر** نیز توسط تیم فنی در فایل `templates/shop/base_shop.html` انجام می‌شود.

### ۹.۵ صفحه ۴۰۴ (صفحه یافت نشد)

اگر کاربر آدرسی نامعتبر در سایت وارد کند، یک صفحه ۴۰۴ سفارشی و زیبا نمایش داده می‌شود (به‌جای صفحه خطای پیش‌فرض). این صفحه شامل:

- پیام فارسی «صفحه مورد نظر یافت نشد»
- دکمه بازگشت به صفحه اصلی
- طراحی مطابق با سایر صفحات سایت

### ۹.۶ لینک‌های ناوبار

ناوبار (منوی بالای سایت) در صفحات فروشگاه شامل لینک‌های زیر است:

- احراز اصالت (`/verify`)
- سوالات متداول (`/faq`)
- درباره ما (`/about`)
- تماس با ما (`/contact`)

---

## 10. سناریو ۹: ثبت مالکیت، خرید هدیه و انتقال شمش

### ۱۰.۱ آشنایی

سیستم سه قابلیت جدید مرتبط با مالکیت شمش دارد:

1. **کد ثبت مالکیت (Claim Code)**: کدی ۶ کاراکتری که هنگام فروش حضوری (POS) یا خرید هدیه تولید می‌شود و خریدار با آن مالکیت شمش را در سایت ثبت می‌کند
2. **خرید هدیه (Gift Purchase)**: مشتری می‌تواند شمشی را به‌عنوان هدیه بخرد — شمش به نام خریدار ثبت نمی‌شود و گیرنده هدیه خودش مالکیت را ثبت می‌کند
3. **انتقال مالکیت (Ownership Transfer)**: مشتری می‌تواند شمش خود را به شخص دیگری منتقل کند

### ۱۰.۲ فروش حضوری (POS) با کد ثبت مالکیت

**چه اتفاقی می‌افتد؟** وقتی نماینده یک شمش را از طریق POS می‌فروشد:

1. نماینده فروش را در POS ثبت می‌کند (وب یا API)
2. سیستم خودکار یک **کد ثبت مالکیت** ۶ کاراکتری تولید می‌کند
3. کد در **رسید فروش** نمایش داده می‌شود (و در پاسخ API برگردانده می‌شود)
4. نماینده کد را به خریدار اعلام می‌کند (روی رسید چاپ شده یا شفاهی)

**آنچه اپراتور باید بداند:**
- کد ثبت مالکیت **خودکار** تولید می‌شود — نیازی به اقدام اپراتور نیست
- خریدار با مراجعه به سایت (`/claim-bar`) و وارد کردن سریال‌کد + کد ثبت مالکیت، شمش را به نام خود ثبت می‌کند
- در لیست شمش‌ها (`/admin/bars`)، شمش‌های فروخته‌شده از POS تا زمان ثبت مالکیت، `customer_id` ندارند اما وضعیت **SOLD** دارند

### ۱۰.۳ سفارش هدیه (Gift Order)

**چه اتفاقی می‌افتد؟** وقتی مشتری هنگام ثبت سفارش آنلاین گزینه «خرید به‌عنوان هدیه» را فعال می‌کند:

1. مشتری در صفحه checkout تیک **«خرید به‌عنوان هدیه»** را می‌زند
2. پس از پرداخت موفق:
   - شمش وضعیت **SOLD** می‌گیرد
   - `customer_id` شمش **NULL** می‌ماند (به نام خریدار ثبت نمی‌شود)
   - سیستم **کد ثبت مالکیت** تولید و به خریدار نمایش می‌دهد
3. خریدار کد را به گیرنده هدیه می‌دهد

**آنچه اپراتور باید بداند (بسته‌بندی و ارسال):**
- سفارش‌های هدیه در لیست سفارشات با علامت **«هدیه»** مشخص هستند
- بسته‌بندی سفارش هدیه ممکن است نیاز به توجه خاص داشته باشد (بدون فاکتور قیمت داخل بسته)
- روند ارسال و تحویل مانند سفارشات عادی است

### ۱۰.۴ ثبت مالکیت توسط مشتری (Claim Bar)

**این فرآیند توسط مشتری انجام می‌شود (نه اپراتور):**

1. مشتری به صفحه `/claim-bar` می‌رود
2. **سریال‌کد** شمش (روی شمش حک شده) و **کد ثبت مالکیت** (از رسید POS یا از خریدار هدیه) را وارد می‌کند
3. سیستم بررسی می‌کند:
   - سریال‌کد معتبر و شمش در سیستم وجود دارد
   - کد ثبت مالکیت صحیح است
   - شمش قبلاً به کسی ثبت نشده
4. مالکیت شمش به مشتری ثبت می‌شود

**اگر مشتری مشکل داشت:**
- اگر کد ثبت مالکیت را گم کرده: باید با پشتیبانی تماس بگیرد (تیکت ثبت کند)
- اگر سریال‌کد اشتباه وارد شده: سیستم پیام خطای مناسب نمایش می‌دهد
- اگر شمش قبلاً ثبت شده: سیستم اجازه ثبت مجدد نمی‌دهد

### ۱۰.۵ مشاهده شمش‌های من (My Bars)

مشتری در صفحه `/my-bars` می‌تواند تمام شمش‌هایی که مالک آن‌هاست را ببیند:
- سریال‌کد
- نام محصول، وزن، عیار
- امکان انتقال هر شمش به شخص دیگر

### ۱۰.۶ انتقال مالکیت شمش (Ownership Transfer)

**چه اتفاقی می‌افتد؟** وقتی مشتری می‌خواهد شمش خود را به شخص دیگری منتقل کند:

**مراحل (از دید مشتری):**

1. مشتری در صفحه `/my-bars` روی دکمه **«انتقال»** کنار شمش مورد نظر کلیک می‌کند
2. **مرحله ۱ — وارد کردن شماره گیرنده**: شماره موبایل شخصی که قرار است شمش به او منتقل شود را وارد می‌کند
3. **مرحله ۲ — تایید هویت فرستنده**: سیستم یک **OTP** به موبایل **مالک فعلی** (فرستنده) ارسال می‌کند — نه گیرنده
4. **مرحله ۳ — تایید نهایی**: مالک OTP را وارد و تایید می‌کند
5. مالکیت شمش به گیرنده منتقل می‌شود:
   - اگر گیرنده حساب کاربری ندارد، سیستم خودکار حساب ایجاد می‌کند
   - شمش در صفحه «شمش‌های من» گیرنده نمایش داده می‌شود
   - شمش از صفحه «شمش‌های من» فرستنده حذف می‌شود

**آنچه اپراتور باید بداند:**
- انتقال مالکیت **کاملاً خودکار** است و نیازی به تایید اپراتور ندارد
- تاریخچه انتقال در **OwnershipHistory** ثبت می‌شود
- اپراتور می‌تواند سابقه مالکیت شمش را در بخش **ویرایش شمش** (`/admin/bars/{id}/edit`) مشاهده کند

### ۱۰.۷ نکات مهم برای اپراتور

| موقعیت | نکته |
|---------|-------|
| فروش POS | کد ثبت مالکیت خودکار تولید می‌شود — مطمئن شوید نماینده کد را به خریدار اعلام کند |
| سفارش هدیه | فاکتور قیمت داخل بسته قرار ندهید — سفارش‌های هدیه علامت‌گذاری شده‌اند |
| شکایت «نمی‌توانم شمش را ثبت کنم» | سریال‌کد و کد ثبت مالکیت را از مشتری بخواهید و در سیستم بررسی کنید |
| شکایت «شمش انتقال نمی‌شود» | بررسی کنید آیا شمش واقعاً به نام مشتری ثبت شده (وضعیت SOLD + customer_id) |
| شکایت «کد ثبت مالکیت گم شده» | در لیست شمش‌ها سریال را جستجو کنید — claim_code قابل مشاهده است |

---

## 11. عیب‌یابی

### مشکل: خطای CSRF بعد از مدت طولانی بی‌کاری

**علامت**: پس از باز ماندن طولانی صفحه، هنگام ثبت فرم خطا می‌دهد.

**راه‌حل**: صفحه را رفرش کنید (Ctrl+F5) و دوباره امتحان کنید.

---

### مشکل: قیمت محصول صفر نمایش می‌دهد

**دلایل احتمالی**:
1. قیمت طلا در تنظیمات سیستم وارد نشده
2. وزن یا عیار محصول صفر است

**راه‌حل**:
1. به تنظیمات بروید و قیمت طلا را بررسی کنید
2. محصول را ویرایش کنید و وزن/عیار صحیح وارد کنید

---

### مشکل: مشتری نمی‌تواند خرید کند (محصول ناموجود)

**دلیل**: هیچ شمشی با وضعیت «تخصیص» (Assigned) برای آن محصول وجود ندارد.

**راه‌حل**:
1. به بخش شمش‌ها بروید
2. شمش‌های خام را پیدا کنید و محصول مربوطه را به آن‌ها تخصیص دهید

---

### مشکل: نماینده نمی‌تواند وارد شود

**دلایل احتمالی**:
1. حساب نماینده غیرفعال شده
2. شماره موبایل اشتباه ثبت شده

**راه‌حل**:
1. در لیست نمایندگان وضعیت را بررسی کنید
2. در صورت غیرفعال بودن، ویرایش کرده و فعال کنید

---

### مشکل: کوپن کار نمی‌کند

**بررسی‌ها**:
1. آیا کوپن **فعال** (ACTIVE) است؟
2. آیا تاریخ انقضا گذشته؟
3. آیا سقف استفاده پر شده؟
4. آیا حداقل مبلغ سفارش رعایت شده؟
5. آیا کوپن «فقط اولین خرید» است و مشتری خرید قبلی دارد؟
6. آیا کوپن «خصوصی» است و موبایل مشتری در لیست سفید نیست؟
7. آیا کوپن محدود به **دسته‌بندی خاص** است و سبد خرید مشتری محصولی از آن دسته‌بندی‌ها ندارد؟

---

### مشکل: درخواست بازخرید ثبت نمی‌شود

**دلایل احتمالی**:
1. سریال‌کد شمش اشتباه است یا شمش در سیستم وجود ندارد
2. شمش وضعیت «فروخته شده» ندارد (فقط شمش‌های فروخته‌شده قابل بازخرید هستند)

---

### مشکل: مشتری نمی‌تواند مالکیت شمش را ثبت کند (Claim)

**دلایل احتمالی**:
1. سریال‌کد یا کد ثبت مالکیت اشتباه وارد شده
2. شمش قبلاً به مشتری دیگری ثبت شده (دارای customer_id)
3. شمش claim_code ندارد (مثلاً از طریق فروش آنلاین معمولی فروخته شده)

**راه‌حل**:
1. سریال‌کد را در بخش شمش‌ها (`/admin/bars`) جستجو کنید
2. بررسی کنید آیا claim_code وجود دارد و آیا customer_id خالی است
3. اگر شمش قبلاً ثبت شده، به مشتری اطلاع دهید

---

### مشکل: انتقال مالکیت شمش انجام نمی‌شود

**دلایل احتمالی**:
1. شمش به نام مشتری ثبت نیست (customer_id خالی)
2. OTP تایید هویت منقضی شده (مشتری باید مجدداً تلاش کند)
3. شماره موبایل گیرنده اشتباه وارد شده

**راه‌حل**:
1. بررسی کنید شمش واقعاً به نام مشتری درخواست‌کننده ثبت شده باشد
2. از مشتری بخواهید فرآیند را از ابتدا تکرار کند

---

## 12. واژه‌نامه

| اصطلاح | توضیح |
|---------|--------|
| **شمش (Bar)** | قطعه فیزیکی طلا با سریال‌کد یکتا |
| **سریال‌کد** | کد ۸ کاراکتری یکتای هر شمش |
| **عیار (Purity)** | خلوص طلا — ۷۵۰ = ۱۸ عیار |
| **اجرت (Wage)** | هزینه ساخت و طراحی شمش |
| **بچ (Batch)** | گروه شمش‌هایی که در یک ذوب تولید شده‌اند |
| **POS** | فروش حضوری (Point of Sale) توسط نماینده |
| **بازخرید (Buyback)** | خرید شمش از مشتری توسط نماینده |
| **کشبک (Cashback)** | مبلغی که پس از تحویل سفارش به کیف پول مشتری واریز می‌شود |
| **OTP** | رمز یک‌بارمصرف ارسالی از طریق SMS |
| **ریال / تومان** | تمام مبالغ در سیستم ریال هستند، در نمایش تومان (÷۱۰) |
| **CSRF** | مکانیزم امنیتی برای جلوگیری از درخواست‌های جعلی |
| **Sandbox** | محیط تست درگاه پرداخت (پرداخت واقعی نیست) |
| **لجر (Ledger)** | دفتر حسابداری — هر تغییر موجودی ثبت می‌شود |
| **شبا (IBAN)** | شماره حساب بانکی بین‌المللی (IR + ۲۴ رقم) |
| **تیکت (Ticket)** | درخواست پشتیبانی از طرف مشتری یا نماینده |
| **تخصیص (Assign)** | اختصاص تیکت به یک اپراتور خاص برای پیگیری |
| **دپارتمان تیکت** | دسته‌بندی تیکت بر اساس نوع درخواست (مالی/فنی/فروش/شکایات/سایر) |
| **یادداشت داخلی (Internal Note)** | یادداشتی در تیکت که فقط کارکنان می‌بینند — مشتری و نماینده دسترسی ندارند |
| **پیوست (Attachment)** | فایل تصویری ضمیمه‌شده به پیام تیکت (JPG/PNG/WEBP تا ۱۰MB) |
| **صفحه ثابت (Static Page)** | صفحه اطلاع‌رسانی با محتوای ثابت (درباره ما، سوالات متداول، تماس با ما، قوانین) — بدون نیاز به لاگین |
| **فوتر (Footer)** | بخش پایین تمام صفحات سایت شامل اطلاعات شرکت، لینک‌های سریع و نشان‌های اعتماد |
| **کلید API** | کلید احراز هویت ۶۴ کاراکتری برای دستگاه POS |
| **اعتبار فروشگاهی (Store Credit)** | مبلغی غیرقابل برداشت که به کیف پول مشتری واریز می‌شود — فقط برای خرید قابل استفاده است |
| **بازگشت اجرت (Wage Refund)** | بازگشت مبلغ اجرت ساخت شمش به مشتری هنگام تایید بازخرید — به‌صورت اعتبار فروشگاهی واریز می‌شود |
| **کد ثبت مالکیت (Claim Code)** | کد ۶ کاراکتری یکتا که هنگام فروش حضوری (POS) یا خرید هدیه تولید می‌شود — خریدار با این کد مالکیت شمش را در سایت ثبت می‌کند |
| **خرید هدیه (Gift Purchase)** | سفارشی که مشتری به‌عنوان هدیه ثبت می‌کند — شمش به نام خریدار ثبت نمی‌شود و کد ثبت مالکیت تولید می‌شود |
| **ثبت مالکیت (Claim)** | فرآیندی که مشتری با سریال‌کد و کد ثبت مالکیت، شمش را به نام خود ثبت می‌کند |
| **انتقال مالکیت (Transfer)** | فرآیندی که مالک شمش آن را به شخص دیگری منتقل می‌کند — نیاز به تایید OTP فرستنده دارد |
| **شمش‌های من (My Bars)** | صفحه‌ای در پنل مشتری که تمام شمش‌های متعلق به مشتری را نمایش می‌دهد |

---

> این راهنما بر اساس قابلیت‌های فعلی سیستم TalaMala v4 (فازهای ۱-۱۴ + صفحات ثابت و فوتر + ثبت مالکیت و انتقال شمش) نوشته شده است.
